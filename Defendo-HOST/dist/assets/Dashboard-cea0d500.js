import{r as i,j as e,u as V,s as B,d as q,a as ee,L as ae,c as de,b as ce,R as me,e as Y}from"./index-221e5e32.js";import{B as xe}from"./BrandLogo-c222ccf7.js";import{A as se}from"./index-cfdf0eb9.js";import{h as E}from"./motion-cb67fe8f.js";const he=({isOpen:t,onClose:h})=>{const[r,l]=i.useState([]);i.useEffect(()=>{const g=p=>{const _=p.detail;l(d=>[{id:_.id||Date.now(),..._},...d])};return window.addEventListener("dashboard:new-notification",g),()=>window.removeEventListener("dashboard:new-notification",g)},[]);const u=g=>{switch(g){case"booking":return"event_available";case"cancellation":return"event_busy";case"payment":return"payments";case"alert":return"warning";default:return"notifications"}},o=g=>{switch(g){case"booking":return"text-green-400 bg-green-500/20";case"cancellation":return"text-red-400 bg-red-500/20";case"payment":return"text-blue-400 bg-blue-500/20";case"alert":return"text-yellow-400 bg-yellow-500/20";default:return"text-gray-400 bg-gray-500/20"}},b=g=>{l(p=>p.map(_=>_.id===g?{..._,unread:!1}:_))},x=g=>{l(p=>p.filter(_=>_.id!==g))};return e.jsx(se,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h}),e.jsxs(E.div,{className:"fixed right-0 top-0 h-full w-96 bg-white border-l border-slate-200 shadow-2xl z-50",initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Notifications"}),e.jsx(E.button,{onClick:h,className:"p-2 rounded-lg hover:bg-slate-100 transition-colors",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx("span",{className:"material-symbols-outlined text-slate-500",children:"close"})})]})}),e.jsxs("div",{className:"p-4 space-y-3 overflow-y-auto h-full",children:[e.jsx(se,{children:r.map((g,p)=>e.jsx(E.div,{initial:{opacity:0,x:50,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:-50,scale:.9},transition:{duration:.3,delay:p*.1,type:"spring",stiffness:200},className:`p-4 rounded-lg border border-slate-200 bg-white hover:bg-slate-50 transition-all duration-200 ${g.unread?"ring-2 ring-[var(--primary-color)]/30":""}`,onClick:()=>b(g.id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(E.div,{className:`w-10 h-10 rounded-full flex items-center justify-center ${o(g.type)}`,whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:300},children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:u(g.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-slate-900 font-medium text-sm truncate",children:g.title}),g.unread&&e.jsx(E.div,{className:"w-2 h-2 bg-[var(--primary-color)] rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0}})]}),e.jsx("p",{className:"text-slate-600 text-xs mb-2 line-clamp-2",children:g.message}),e.jsx("p",{className:"text-slate-400 text-xs",children:g.time})]}),e.jsx(E.button,{onClick:_=>{_.stopPropagation(),x(g.id)},className:"p-1 rounded hover:bg-slate-100 transition-colors opacity-0 group-hover:opacity-100",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-sm",children:"close"})})]})},g.id))}),r.length===0&&e.jsxs(E.div,{className:"text-center py-12",initial:{opacity:0},animate:{opacity:1},children:[e.jsx(E.span,{className:"material-symbols-outlined text-slate-300 text-4xl mb-3 block",animate:{y:[0,-4,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:"notifications_none"}),e.jsx("p",{className:"text-slate-500",children:"No notifications"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"You're all caught up!"})]})]})]})]})})},J=({className:t=""})=>e.jsx(E.div,{className:`bg-white/5 rounded-lg animate-pulse ${t}`,initial:{opacity:.5},animate:{opacity:[.5,.8,.5]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),ue=()=>e.jsxs("div",{className:"space-y-8 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"h-8 w-64"}),e.jsx(J,{className:"h-4 w-48"})]}),e.jsx(J,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(t=>e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(J,{className:"h-4 w-24"}),e.jsx(J,{className:"h-8 w-8 rounded-full"})]}),e.jsx(J,{className:"h-8 w-16 mb-2"}),e.jsx(J,{className:"h-3 w-20"})]},t))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10",children:[e.jsx(J,{className:"h-6 w-32 mb-4"}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(J,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(J,{className:"h-4 w-3/4"}),e.jsx(J,{className:"h-3 w-1/2"})]}),e.jsx(J,{className:"h-8 w-20"})]},t))})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10",children:[e.jsx(J,{className:"h-6 w-24 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx(J,{className:"h-4 w-20"}),e.jsx(J,{className:"h-4 w-16"})]},t))})]})})]})]}),pe=()=>{var f;const{user:t,hostProfile:h,loading:r}=V(),[l,u]=i.useState({totalBookings:0,activeBookings:0,assignedBookings:0,completedBookings:0,monthlyRevenue:0,recentBookings:[]}),[o,b]=i.useState(!1),[x,g]=i.useState(null),[p,_]=i.useState(!1),[d,I]=i.useState(null),[O,U]=i.useState(!1);i.useEffect(()=>{},[t,h]);const P=i.useCallback(async()=>{if(!t||r){b(!1);return}try{b(!0),g(null);const s=new Date;s.setDate(1),s.setHours(0,0,0,0);const[{data:a,error:v},{data:m,error:N},{data:k,error:c},{data:R,error:y},{data:L,error:z},{data:w,error:F},M]=await Promise.all([B.from("bookings").select("id").eq("provider_id",t.id),B.from("bookings").select("id").eq("provider_id",t.id).in("status",["pending","confirmed"]),B.from("bookings").select("id").eq("provider_id",t.id).eq("status","assigned"),B.from("bookings").select("id").eq("provider_id",t.id).eq("status","completed"),B.from("bookings").select("price, payment_status, service_type, status, date, created_at").eq("provider_id",t.id).gte("created_at",s.toISOString()).eq("status","completed").eq("payment_status","paid"),B.from("bookings").select("id, service_type, status, created_at, price, host_id:provider_id").eq("provider_id",t.id).order("created_at",{ascending:!1}).limit(5),q.getMonthlyAnalytics(t.id)]);(v||N||c||y||z||F)&&[v,N,c,y,z,F].some(Z=>Z&&(Z.code==="PGRST301"||Z.status===403))&&_(!0);const H=(a==null?void 0:a.length)||0,n=(m==null?void 0:m.length)||0,$=(k==null?void 0:k.length)||0,G=(R==null?void 0:R.length)||0,A=(L==null?void 0:L.reduce((D,Z)=>D+Number(Z.price||0),0))||0,T=Array.isArray(L)?L:[],K=M&&M.data?M.data:[];u({totalBookings:H,activeBookings:n,assignedBookings:$,completedBookings:G,monthlyRevenue:A,recentBookings:w||[],monthlyPaidBookings:T,analytics:K}),console.log("Dashboard data loaded:",{totalBookings:H,activeBookings:n,assignedBookings:$,completedBookings:G,monthlyRevenue:A})}catch(s){console.error("Dashboard load error:",s),g("Failed to load dashboard data")}finally{b(!1)}},[t,r]);i.useEffect(()=>{P()},[P]),i.useEffect(()=>{if(!(t!=null&&t.id))return;const s=B.channel(`bookings_inserts_${t.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"bookings",filter:`provider_id=eq.${t.id}`},a=>{const v=a.new||{},m=v.date?new Date(v.date).toLocaleString():"upcoming",N=`${v.service_type||"Service"} booked for ${m}`;window.dispatchEvent(new CustomEvent("dashboard:new-notification",{detail:{id:v.id,type:"booking",title:"New Booking Received",message:N,time:"Just now",unread:!0}})),U(!0),P()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"bookings",filter:`provider_id=eq.${t.id}`},()=>{P()}).subscribe();return()=>{try{B.removeChannel(s)}catch{}}},[t==null?void 0:t.id,P]);const S=()=>{var s;return h!=null&&h.company_name?h.company_name:h!=null&&h.full_name?h.full_name:((s=t==null?void 0:t.email)==null?void 0:s.split("@")[0])||"Host"},C=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(s);if(r||o)return e.jsx(ue,{});if(x)return e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"material-symbols-outlined text-red-400",children:"error"}),e.jsx("h3",{className:"text-red-400 font-medium",children:"Dashboard Error"})]}),e.jsx("p",{className:"text-red-400/80 text-sm mb-4",children:x}),e.jsx("button",{onClick:()=>window.location.reload(),className:"bg-red-500/20 hover:bg-red-500/30 text-red-400 px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"Refresh Page"})]});const j=[{label:"Total Bookings",value:l.totalBookings,icon:"event",growth:12,growthType:"increase"},{label:"Active Bookings",value:l.activeBookings,icon:"pending",growth:5,growthType:"increase"},{label:"Assigned",value:l.assignedBookings,icon:"assignment_turned_in",growth:3,growthType:"increase"},{label:"Completed",value:l.completedBookings,icon:"check_circle",growth:8,growthType:"increase"},{label:"Monthly Revenue",value:l.monthlyRevenue,icon:"attach_money",growth:15,growthType:"increase",isCurrency:!0}];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30 text-slate-900 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 opacity-40 pointer-events-none",children:[e.jsx(E.div,{className:"absolute top-20 right-20 w-72 h-72 bg-gradient-to-br from-[var(--primary-color)]/10 to-sky-200/20 rounded-full blur-3xl",animate:{scale:[1,1.1,1],opacity:[.2,.3,.2]},transition:{duration:8,repeat:1/0,ease:"easeInOut"}}),e.jsx(E.div,{className:"absolute bottom-16 left-16 w-72 h-72 bg-gradient-to-br from-sky-200/15 to-emerald-200/25 rounded-full blur-3xl",animate:{scale:[1.1,1,1.1],opacity:[.15,.25,.15]},transition:{duration:7,repeat:1/0,ease:"easeInOut"}})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs(E.div,{className:"mb-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-extrabold bg-gradient-to-r from-slate-900 via-slate-800 to-[var(--primary-color)] bg-clip-text text-transparent mb-3",children:["Welcome Back, ",S()]}),e.jsx("p",{className:"text-slate-600 text-base md:text-lg",children:"Here's what's happening with your security services today."})]}),e.jsxs(E.button,{onClick:()=>U(!0),className:"relative p-4 rounded-2xl bg-white border border-slate-200 shadow-lg hover:border-[var(--primary-color)]/60 hover:shadow-xl hover:shadow-[var(--primary-color)]/20 transition-all duration-300",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx("span",{className:"material-symbols-outlined text-[var(--primary-color)] text-xl",children:"notifications"}),e.jsx(E.div,{className:"absolute -top-1 -right-1 w-3 h-3 bg-[var(--primary-color)] rounded-full shadow-lg",animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0}})]})]}),p&&e.jsxs(E.div,{className:"mt-6 p-4 rounded-2xl bg-amber-50 border border-amber-200 text-amber-700 text-sm",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:["Access to bookings is restricted by database policies (RLS). Use the button below to verify visibility for your account.",e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:async()=>{const{count:s,error:a}=await B.from("bookings").select("id",{count:"exact",head:!0}).eq("provider_id",t.id);I(a?null:typeof s=="number"?s:0)},className:"px-4 py-2 rounded-xl bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-200 transition-all duration-300",children:["Run RLS test for provider_id = ",(f=t==null?void 0:t.id)==null?void 0:f.slice(0,8),"…"]}),d!==null&&e.jsxs("span",{className:"ml-3 text-[#C5C6C7]",children:["Visible bookings: ",d]})]})]})]}),e.jsx(E.div,{className:"mb-8 p-6 rounded-2xl bg-gradient-to-r from-[var(--primary-color)]/10 to-sky-100/60 border border-[var(--primary-color)]/30",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white rounded-xl shadow-sm",children:e.jsx("span",{className:"material-symbols-outlined text-[var(--primary-color)] text-xl",children:"verified"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Account Verified"}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Your security services are active and ready for bookings"})]})]})}),e.jsx(E.div,{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-5 md:gap-6 mb-10",initial:"hidden",animate:"visible",variants:{hidden:{},visible:{transition:{staggerChildren:.1}}},children:j.map((s,a)=>{const v=[{bg:"from-blue-500 to-blue-600",border:"border-blue-200/80",shadow:"shadow-blue-200/30"},{bg:"from-emerald-500 to-emerald-600",border:"border-emerald-200/80",shadow:"shadow-emerald-200/30"},{bg:"from-sky-500 to-sky-600",border:"border-sky-200/80",shadow:"shadow-sky-200/30"},{bg:"from-amber-500 to-amber-600",border:"border-amber-200/80",shadow:"shadow-amber-200/30"},{bg:"from-purple-500 to-purple-600",border:"border-purple-200/80",shadow:"shadow-purple-200/30"}],m=v[a%v.length];return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},className:`group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-slate-50/50 border ${m.border} shadow-lg hover:shadow-2xl hover:${m.shadow} transition-all duration-300 hover:-translate-y-2`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-slate-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-xs font-semibold uppercase tracking-wider mb-2",children:s.label}),e.jsx("p",{className:"text-4xl font-extrabold text-slate-900 mb-1",children:s.isCurrency?C(s.value):s.value.toLocaleString()}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-2",children:[e.jsxs("span",{className:"text-emerald-600 text-xs font-bold",children:["+",s.growth,"%"]}),e.jsx("span",{className:"text-slate-400 text-xs",children:"vs last month"})]})]}),e.jsx("div",{className:`p-4 bg-gradient-to-br ${m.bg} rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300`,children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:s.icon})})]})]},a)})}),e.jsxs(E.div,{className:"mb-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"analytics"})}),e.jsx("h2",{className:"text-3xl font-bold text-slate-900",children:"Analytics Overview"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl bg-white border border-slate-200 shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-4",children:"Monthly Bookings"}),e.jsx("div",{className:"h-64 flex items-center justify-center bg-slate-50 rounded-xl border border-slate-200",children:e.jsxs("div",{className:"text-slate-400 text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 block",children:"show_chart"}),e.jsx("p",{children:"Chart visualization coming soon"})]})})]}),e.jsxs("div",{className:"rounded-2xl bg-white border border-slate-200 shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-4",children:"Revenue Trends"}),e.jsx("div",{className:"h-64 flex items-center justify-center bg-slate-50 rounded-xl border border-slate-200",children:e.jsxs("div",{className:"text-slate-400 text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl mb-4 block",children:"trending_up"}),e.jsx("p",{children:"Chart visualization coming soon"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(E.div,{className:"rounded-2xl bg-white border border-slate-200 shadow-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-sky-500 to-sky-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"schedule"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900",children:"Recent Bookings"})]}),e.jsxs("div",{className:"space-y-3",children:[(l.recentBookings||[]).slice(0,5).map((s,a)=>e.jsxs(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6+a*.1},className:"flex items-center gap-4 p-4 rounded-xl bg-slate-50 border border-slate-200 hover:bg-slate-100 hover:shadow-md transition-all duration-300",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded-full shadow-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-900 font-semibold capitalize",children:s.service_type||"Service"}),e.jsx("p",{className:"text-slate-500 text-sm capitalize",children:s.status})]}),e.jsx("div",{className:"text-slate-500 text-sm font-medium",children:s.created_at?new Date(s.created_at).toLocaleDateString():"N/A"})]},s.id)),(!l.recentBookings||l.recentBookings.length===0)&&e.jsxs("div",{className:"text-center py-12 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl mb-3 block text-slate-400",children:"event_available"}),e.jsx("p",{className:"text-slate-500",children:"No recent bookings"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(E.div,{className:"rounded-2xl bg-white border border-slate-200 shadow-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"security"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900",children:"Guard Status"})]}),e.jsx("div",{className:"space-y-3",children:[{name:"John Smith",status:"on-duty",time:"2h 15m ago"},{name:"Mike Johnson",status:"online",time:"5m ago"},{name:"Sarah Wilson",status:"off-duty",time:"1h 30m ago"}].map((s,a)=>e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.7+a*.1},className:"flex items-center gap-3 p-3 rounded-xl bg-slate-50 border border-slate-200 hover:bg-slate-100 transition-all duration-300",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-[var(--primary-color)] to-emerald-500 rounded-full flex items-center justify-center text-white font-bold shadow-lg",children:s.name.split(" ").map(v=>v[0]).join("")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-slate-900 font-semibold",children:s.name}),e.jsx("p",{className:"text-slate-500 text-sm capitalize",children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.status==="on-duty"?"bg-emerald-500":s.status==="online"?"bg-blue-500":"bg-slate-400"} shadow-lg`}),e.jsx("span",{className:"text-slate-500 text-xs",children:s.time})]})]},a))})]}),e.jsx(E.button,{className:"w-full p-6 rounded-2xl bg-white border border-slate-200 shadow-lg hover:shadow-xl hover:border-[var(--primary-color)]/40 transition-all duration-300 group",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},whileHover:{scale:1.02},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl group-hover:scale-110 transition-transform duration-300 shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"map"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Live Map View"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Track guard locations in real-time"})]})]})}),e.jsxs(E.div,{className:"rounded-2xl bg-white border border-slate-200 shadow-lg p-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"calendar_month"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900",children:"This Month"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-slate-200",children:[e.jsx("div",{className:"text-slate-600 text-sm font-medium",children:"Paid bookings"}),e.jsx("div",{className:"font-bold text-slate-900 text-lg",children:(l.monthlyPaidBookings||[]).length})]}),e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("div",{className:"text-slate-600 text-sm font-medium",children:"Revenue"}),e.jsx("div",{className:"font-bold text-[var(--primary-color)] text-lg",children:C(l.monthlyRevenue||0)})]})]})]})]})]})]}),e.jsx(he,{isOpen:O,onClose:()=>U(!1)})]})},oe=({images:t,className:h=""})=>{const[r,l]=i.useState(0),[u,o]=i.useState(!1),[b,x]=i.useState("next");if(!t||t.length===0)return e.jsx("div",{className:`w-full h-48 bg-gradient-to-br from-[#29382f] to-[#1a241e] rounded-xl flex items-center justify-center ${h}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 mx-auto flex items-center justify-center shadow-[0_8px_30px_rgba(0,0,0,0.15)]",children:e.jsx("span",{className:"material-symbols-outlined text-white/50 text-3xl",children:"imagesmode"})}),e.jsx("p",{className:"text-white/50 text-sm mt-2",children:"Images coming soon"})]})});i.useEffect(()=>{if(t.length<=1)return;const f=setInterval(()=>{x("next"),o(!0),setTimeout(()=>{l(s=>s===t.length-1?0:s+1),o(!1)},150)},4e3);return()=>clearInterval(f)},[t.length]);const g=()=>{u||(x("prev"),o(!0),setTimeout(()=>{l(f=>f===0?t.length-1:f-1),o(!1)},150))},p=()=>{u||(x("next"),o(!0),setTimeout(()=>{l(f=>f===t.length-1?0:f+1),o(!1)},150))},_=f=>{u||f===r||(x(f>r?"next":"prev"),o(!0),setTimeout(()=>{l(f),o(!1)},150))},[d,I]=i.useState(!1),[O,U]=i.useState(null),P=()=>I(!0),S=()=>I(!1);i.useEffect(()=>{if(!d)return;const f=s=>{s.key==="Escape"&&S(),s.key==="ArrowRight"&&p(),s.key==="ArrowLeft"&&g()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[d]);const C=f=>U(f.changedTouches[0].clientX),j=f=>{if(O==null)return;const s=f.changedTouches[0].clientX-O;Math.abs(s)>40&&(s<0?p():g()),U(null)};return e.jsxs("div",{className:`relative w-full h-48 rounded-xl overflow-hidden group ${h}`,children:[e.jsxs("div",{className:"relative w-full h-full overflow-hidden cursor-zoom-in",onClick:P,children:[e.jsx("div",{className:`w-full h-full transition-all duration-500 ease-in-out ${u?b==="next"?"transform -translate-x-full opacity-0 scale-95":"transform translate-x-full opacity-0 scale-95":"transform translate-x-0 opacity-100 scale-100"}`,style:{backgroundImage:`url(${t[r]})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsx("img",{src:t[r],alt:`Service image ${r+1}`,className:`w-full h-full object-cover transition-all duration-700 ease-out ${u?"blur-sm scale-110":"blur-0 scale-100 group-hover:scale-105"}`,onClick:P,onError:f=>{f.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjkzODJmIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIEVycm9yPC90ZXh0Pjwvc3ZnPg=="}})}),u&&e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-white/30 border-t-white rounded-full animate-spin"})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"}),t.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),g()},disabled:u,className:`absolute left-2 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-300 hover:scale-110 hover:shadow-lg ${u?"opacity-30 cursor-not-allowed":"opacity-0 group-hover:opacity-100"}`,"aria-label":"Previous image",children:e.jsx("span",{className:`material-symbols-outlined text-sm transition-transform duration-200 ${u?"animate-pulse":""}`,children:"chevron_left"})}),e.jsx("button",{onClick:f=>{f.stopPropagation(),p()},disabled:u,className:`absolute right-2 top-1/2 transform -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full transition-all duration-300 hover:scale-110 hover:shadow-lg ${u?"opacity-30 cursor-not-allowed":"opacity-0 group-hover:opacity-100"}`,"aria-label":"Next image",children:e.jsx("span",{className:`material-symbols-outlined text-sm transition-transform duration-200 ${u?"animate-pulse":""}`,children:"chevron_right"})})]}),t.length>1&&e.jsx("div",{className:`absolute top-2 right-2 bg-black/50 text-white px-2 py-1 rounded-full text-xs transition-all duration-300 ${u?"opacity-50 scale-95":"opacity-0 group-hover:opacity-100 scale-100"}`,children:e.jsxs("span",{className:"animate-fade-in-up",children:[r+1," / ",t.length]})})]}),t.length>1&&e.jsx("div",{className:`absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1 transition-all duration-300 ${u?"opacity-50":"opacity-0 group-hover:opacity-100"}`,children:t.map((f,s)=>e.jsx("button",{onClick:a=>{a.stopPropagation(),_(s)},disabled:u,className:`w-2 h-2 rounded-full transition-all duration-300 hover:scale-125 ${s===r?"bg-white scale-125 shadow-lg animate-pulse":"bg-white/50 hover:bg-white/75 hover:shadow-md"} ${u?"cursor-not-allowed":"cursor-pointer"}`,"aria-label":`Go to image ${s+1}`},s))}),t.length>1&&e.jsx("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 transition-all duration-300 ${u?"opacity-50":"opacity-0 group-hover:opacity-100"}`,children:e.jsx("div",{className:"flex space-x-1 overflow-x-auto scrollbar-hide",children:t.map((f,s)=>e.jsx("button",{onClick:a=>{a.stopPropagation(),_(s)},disabled:u,className:`flex-shrink-0 w-8 h-8 rounded overflow-hidden border-2 transition-all duration-300 hover:scale-110 ${s===r?"border-white scale-110 shadow-lg ring-2 ring-white/30":"border-white/50 hover:border-white/75 hover:shadow-md"} ${u?"cursor-not-allowed opacity-50":"cursor-pointer"}`,style:{animationDelay:`${s*.1}s`},children:e.jsx("img",{src:f,alt:`Thumbnail ${s+1}`,className:`w-full h-full object-cover transition-all duration-300 ${s===r?"brightness-110":"brightness-75 hover:brightness-100"}`,onError:a=>{a.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzI5MzgyZiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iOCIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkU8L3RleHQ+PC9zdmc+"}})},s))})}),e.jsx(se,{children:d&&e.jsxs(E.div,{className:"fixed inset-0 z-[100] bg-black/90 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("button",{onClick:S,className:"absolute top-4 right-4 text-white/80 hover:text-white p-2 rounded-full hover:bg-white/10","aria-label":"Close",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",children:"close"})}),e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center px-10 select-none",onTouchStart:C,onTouchEnd:j,children:[t.length>1&&e.jsx("button",{onClick:g,className:"absolute left-4 md:left-8 top-1/2 -translate-y-1/2 text-white/90 hover:text-white bg-white/10 hover:bg-white/20 p-3 rounded-full","aria-label":"Previous image",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",children:"chevron_left"})}),e.jsx(E.img,{src:t[r],alt:`Service image ${r+1}`,className:"max-h-[80vh] max-w-[90vw] object-contain rounded-lg shadow-2xl",initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.98},transition:{type:"spring",stiffness:200,damping:24},onError:f=>{f.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjM1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMDAwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI2ZmZiIgZHk9Ii40ZW0iPkltYWdlIEVycm9yPC90ZXh0Pjwvc3ZnPg=="}},r),t.length>1&&e.jsx("button",{onClick:p,className:"absolute right-4 md:right-8 top-1/2 -translate-y-1/2 text-white/90 hover:text-white bg-white/10 hover:bg-white/20 p-3 rounded-full","aria-label":"Next image",children:e.jsx("span",{className:"material-symbols-outlined text-3xl",children:"chevron_right"})})]}),t.length>1&&e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 px-4",children:t.map((f,s)=>e.jsx("button",{onClick:()=>_(s),className:`w-14 h-14 rounded overflow-hidden border ${s===r?"border-white":"border-white/30"}`,children:e.jsx("img",{src:f,alt:`Thumbnail ${s+1}`,className:"w-full h-full object-cover"})},s))})]})})]})},ge=({service:t,onBack:h,onEdit:r,onDelete:l})=>{const u=ee(),[o,b]=i.useState(!1),[x,g]=i.useState({}),[p,_]=i.useState(null),[d,I]=i.useState(0),O=N=>{if(!N)return{};try{const k=typeof N=="string"?JSON.parse(N):N;return k&&typeof k=="object"?k:{}}catch{return{}}},U=async N=>{const k={};for(const[c,R]of Object.entries(N))if(R.images&&R.images.length>0){const y=[];for(const L of R.images)try{let z=L;if(L.includes("/storage/v1/object/")){let M;if(L.includes("/public/guard_services/")?M=L.split("/storage/v1/object/public/guard_services/"):L.includes("/guard_services/")&&(M=L.split("/storage/v1/object/guard_services/")),M&&M.length>1)z=M[1],console.log("Extracted file path:",z);else{console.warn("Could not extract file path from URL:",L);continue}}const{data:w,error:F}=await B.storage.from("guard_services").createSignedUrl(z,60*60*24*7);if(F){console.error("Error generating signed URL for",z,":",F);continue}else y.push(w.signedUrl)}catch(z){console.error("Error processing image path:",L,z);continue}k[c]=y}return k};i.useEffect(()=>{const N=O(t.sub_category);N&&Object.keys(N).length>0&&U(N).then(g)},[t.sub_category]);const P=(N,k)=>{_(N),I(k)},S=()=>{_(null),I(0)},C=()=>{p&&d<p.length-1&&I(d+1)},j=()=>{p&&d>0&&I(d-1)};i.useEffect(()=>{const N=k=>{p&&(k.key==="Escape"?S():k.key==="ArrowRight"?C():k.key==="ArrowLeft"&&j())};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[p,d]);const f={guards:{label:"Security Guards",icon:"security",color:"from-blue-500 to-cyan-500"},drones:{label:"Drone Services",icon:"drone",color:"from-orange-500 to-red-500"},agencies:{label:"Security Agencies",icon:"business",color:"from-green-500 to-emerald-500"},other:{label:"Other Services",icon:"more_horiz",color:"from-gray-500 to-gray-600"}},s=f[t.service_type]||f.other,a=O(t.sub_category),v=a&&Object.keys(a).length>0,m=async()=>{if(window.confirm(`Are you sure you want to delete "${t.name}"? This action cannot be undone.`)){b(!0);try{const{error:N}=await q.deleteHostService(t.id);if(N){console.error("Error deleting service:",N),alert("Failed to delete service: "+N.message);return}u("/dashboard/services")}catch(N){console.error("Exception deleting service:",N),alert("Failed to delete service: "+N.message)}finally{b(!1)}}};return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"space-y-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:h,className:"flex items-center gap-2 text-white/70 hover:text-white transition-colors group",children:[e.jsx("span",{className:"material-symbols-outlined group-hover:-translate-x-1 transition-transform",children:"arrow_back"}),e.jsx("span",{children:"Back to Services"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-white/10 to-white/5 rounded-2xl p-8 border border-white/10 backdrop-blur-md",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"md:w-1/3",children:e.jsx("div",{className:"aspect-square rounded-xl overflow-hidden shadow-2xl",children:e.jsx(oe,{images:t.images||[],className:"w-full h-full object-cover"})})}),e.jsxs("div",{className:"md:w-2/3 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${s.color} shadow-lg`,children:e.jsx("span",{className:"material-symbols-outlined text-white text-2xl",children:s.icon})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:t.name}),e.jsx("p",{className:"text-white/70 text-lg",children:s.label})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${t.is_active?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,children:t.is_active?"Active":"Inactive"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"material-symbols-outlined text-yellow-400",children:"star"}),e.jsx("span",{className:"text-white font-medium",children:t.rating||0})]})]})]}),e.jsx("p",{className:"text-white/80 text-lg leading-relaxed",children:t.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-[var(--primary-color)]",children:t.total_bookings||0}),e.jsx("p",{className:"text-white/70 text-sm",children:"Total Bookings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white truncate max-w-[16rem] mx-auto",children:t.company_name||"—"}),e.jsx("p",{className:"text-white/70 text-sm",children:"Company"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:t.rating||0}),e.jsx("p",{className:"text-white/70 text-sm",children:"Rating"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:v?Object.keys(a).length:0}),e.jsx("p",{className:"text-white/70 text-sm",children:"Subcategories"})]})]})]})]})}),v&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1},className:"bg-gradient-to-br from-white/10 to-white/5 rounded-2xl p-8 border border-white/10 backdrop-blur-md",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:`p-2 rounded-lg bg-gradient-to-br ${s.color}`,children:e.jsx("span",{className:"material-symbols-outlined text-white",children:"category"})}),"Service Subcategories & Pricing"]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-400 mb-2",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"info"}),e.jsx("span",{className:"font-medium",children:"Subcategory Images Storage"})]}),e.jsxs("p",{className:"text-white/70",children:["Images are stored in Supabase ",e.jsx("code",{className:"bg-white/10 px-1 rounded",children:"guard_services"})," bucket and should display automatically.",!v&&" No subcategories found - create a service with guard types to see images here."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(a).map(([N,k])=>e.jsxs(E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"bg-white/5 rounded-xl p-6 border border-white/10 hover:border-white/20 transition-all duration-300",children:[x[N]&&x[N].length>0&&e.jsxs("div",{className:"mb-4 rounded-lg overflow-hidden bg-white/5 cursor-pointer hover:opacity-90 transition-opacity group relative",onClick:()=>P(x[N],0),children:[e.jsx("img",{src:x[N][0],alt:k.label,className:"w-full h-32 object-cover",onError:c=>{console.error("Failed to load subcategory image:",x[N][0]),c.target.style.display="none",c.target.parentElement.innerHTML=`
                          <div class="w-full h-32 flex items-center justify-center bg-white/5 text-white/50">
                            <span class="material-symbols-outlined">broken_image</span>
                          </div>
                        `}}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-white/0 group-hover:text-white/80 transition-colors text-2xl",children:"zoom_in"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:k.label}),e.jsx("div",{className:"flex items-center gap-2",children:x[N]&&x[N].length>0?e.jsxs("span",{className:"flex items-center gap-1 text-green-400 text-xs",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"image"}),x[N].length," images"]}):e.jsxs("span",{className:"flex items-center gap-1 text-orange-400 text-xs",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"image_not_supported"}),"No images"]})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Hourly Rate:"}),e.jsxs("span",{className:"text-[var(--primary-color)] font-bold text-lg",children:[k.currency||"INR"," ",k.price_per_hour,"/hr"]})]}),k.description&&e.jsx("p",{className:"text-white/70 text-sm",children:k.description}),k.availability!==void 0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white/70 text-sm",children:"Available:"}),e.jsxs("span",{className:"text-green-400 font-medium",children:[k.availability," units"]})]}),x[N]&&x[N].length>1&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("p",{className:"text-white/70 text-sm mb-2",children:["Additional Images (",x[N].length-1,"):"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:x[N].slice(1,4).map((c,R)=>e.jsxs("div",{className:"relative cursor-pointer hover:opacity-90 transition-opacity group",onClick:()=>P(x[N],R+1),children:[e.jsx("img",{src:c,alt:`${k.label} ${R+2}`,className:"w-full h-16 object-cover rounded bg-white/5",onError:y=>{console.error("Failed to load additional image:",c),y.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjMzMzMzMzIi8+CjxwYXRoIGQ9Ik0yNCAyMEwyNCA0NEwyMiA0NEwyMiAyMEgyNFoiIGZpbGw9IiM2NjY2NjYiLz4KPHBhdGggZD0iTTI2IDIySDQ0SDQ2VDQ2IDI0SDQ2VjQySDQ0SDI2SDI0VjIySDI2WiIgZmlsbD0iIzY2NjY2NiIvPgo8cGF0aCBkPSJNMjYgMjRIMzBIMzJIMzRIMzZIMzgyNEgzNkgzNFozMkgzMEgyNloyNFoyNFoiIGZpbGw9IiM2NjY2NjYiLz4KPC9zdmc+"}}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center rounded",children:e.jsx("span",{className:"material-symbols-outlined text-white/0 group-hover:text-white/80 transition-colors text-lg",children:"zoom_in"})}),R===2&&x[N].length>4&&e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded flex items-center justify-center",children:e.jsxs("span",{className:"text-white text-xs font-bold",children:["+",x[N].length-4]})})]},R))})]})]})]},N))})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.2},className:"bg-gradient-to-br from-white/10 to-white/5 rounded-2xl p-8 border border-white/10 backdrop-blur-md",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:`p-2 rounded-lg bg-gradient-to-br ${s.color}`,children:e.jsx("span",{className:"material-symbols-outlined text-white",children:"location_on"})}),"Service Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(t.city||t.state)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Location"}),e.jsxs("div",{className:"flex items-center gap-2 text-white/80",children:[e.jsx("span",{className:"material-symbols-outlined text-[var(--primary-color)]",children:"location_on"}),e.jsxs("span",{children:[t.city,", ",t.state]})]})]}),t.specializations&&t.specializations.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Specializations"}),e.jsx("div",{className:"flex flex flex-wrap gap-2",children:t.specializations.map((N,k)=>e.jsx("span",{className:"px-3 py-1 bg-white/10 rounded-full text-sm text-white/80",children:N},k))})]}),t.equipment_included&&t.equipment_included.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Equipment Included"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.equipment_included.map((N,k)=>e.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-full text-sm text-green-400",children:N},k))})]})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:()=>u(`/dashboard/services/${t.id}/edit`),className:"flex-1 bg-gradient-to-r from-[var(--primary-color)] to-[#2a5a3a] text-[#111714] py-4 px-6 rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-[var(--primary-color)]/25 transition-all duration-300 ripple group",children:[e.jsx("span",{className:"material-symbols-outlined mr-2 group-hover:rotate-12 transition-transform",children:"edit"}),"Edit Service"]}),e.jsx("button",{onClick:m,disabled:o,className:"flex-1 bg-red-500/20 text-red-400 py-4 px-6 rounded-xl font-bold text-lg hover:bg-red-500/30 hover:shadow-lg hover:shadow-red-500/25 transition-all duration-300 ripple group disabled:opacity-50",children:o?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-red-400 border-t-transparent rounded-full animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined mr-2 group-hover:scale-110 transition-transform",children:"delete"}),"Delete Service"]})})]}),p&&e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4",onClick:S,children:[e.jsx("button",{onClick:S,className:"absolute top-4 right-4 z-10 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"close"})}),p.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:N=>{N.stopPropagation(),j()},disabled:d===0,className:"absolute left-4 z-10 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"chevron_left"})}),e.jsx("button",{onClick:N=>{N.stopPropagation(),C()},disabled:d===p.length-1,className:"absolute right-4 z-10 p-2 bg-black/50 rounded-full text-white hover:bg-black/70 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("span",{className:"material-symbols-outlined text-2xl",children:"chevron_right"})})]}),e.jsxs("div",{className:"relative max-w-full max-h-full",onClick:N=>N.stopPropagation(),children:[e.jsx("img",{src:p[d],alt:`Image ${d+1}`,className:"max-w-full max-h-full object-contain rounded-lg",onError:N=>{console.error("Failed to load fullscreen image:",p[d]),N.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjMzMzMzMzIi8+CjxwYXRoIGQ9Ik0yNCAyMEwyNCA0NEwyMiA0NEwyMiAyMEgyNFoiIGZpbGw9IiM2NjY2NjYiLz4KPHBhdGggZD0iTTI2IDIySDQ0SDQ2VDQ2IDI0SDQ2VjQySDQ0SDI2SDI0VjIySDI2WiIgZmlsbD0iIzY2NjY2NiIvPgo8cGF0aCBkPSJNMjYgMjRIMzBIMzJIMzRIMzZIMzgyNEgzNkgzNFozMkgzMEgyNloyNFoyNFoiIGZpbGw9IiM2NjY2NjYiLz4KPC9zdmc+"}}),p.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:[d+1," / ",p.length]})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 text-white/70 text-sm",children:[e.jsxs("p",{children:["Press ",e.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"ESC"})," to close"]}),p.length>1&&e.jsxs("p",{children:["Use ",e.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"←"})," ",e.jsx("kbd",{className:"bg-white/20 px-1 rounded",children:"→"})," to navigate"]})]})]})]})},be=()=>{const t=ee(),{user:h,hostProfile:r}=V(),[l,u]=i.useState([]),[o,b]=i.useState(!0),[x,g]=i.useState(null),[p,_]=i.useState(null),[d,I]=i.useState(!1),[O,U]=i.useState(null),[P,S]=i.useState(null),[C,j]=i.useState(""),[f,s]=i.useState("all"),[a,v]=i.useState("recent"),m=n=>{if(!n)return{};try{const $=typeof n=="string"?JSON.parse(n):n;return $&&typeof $=="object"?$:{}}catch{return{}}},N={guards:{label:"Guards",icon:"security",color:"from-blue-500 to-cyan-500"},drones:{label:"Drones",icon:"drone",color:"from-orange-500 to-red-500"},agencies:{label:"Agencies",icon:"business",color:"from-green-500 to-emerald-500"},other:{label:"Other",icon:"more_horiz",color:"from-gray-500 to-gray-600"}};i.useEffect(()=>{(async()=>{if(h)try{b(!0),g(null),console.log("Fetching services for user:",h.id);const{data:$,error:G}=await q.getHostServices(h.id);if(G){console.error("Error fetching services:",G),g(G.message);return}console.log("Services fetched successfully:",$),u($||[])}catch($){console.error("Exception fetching services:",$),g($.message||"Failed to fetch services")}finally{b(!1)}})()},[h]);const k=async n=>{I(!0);try{console.log("Deleting service:",n);const{error:$}=await q.deleteHostService(n);if($){console.error("Error deleting service:",$),g($.message);return}u(G=>G.filter(A=>A.id!==n)),_(null),console.log("Service deleted successfully")}catch($){console.error("Exception deleting service:",$),g($.message||"Failed to delete service")}finally{I(!1)}},c=async n=>{const $=!n.is_active,G=$?"Activate this service? It will become visible to customers.":"Deactivate this service? It will be hidden from customers.",A=$?`

Warning: Make sure pricing and details are correct before activating.`:`

Warning: Existing bookings are unaffected; new bookings will be disabled.`;if(window.confirm(G+A))try{U(n.id),u(K=>K.map(D=>D.id===n.id?{...D,is_active:$}:D));const{error:T}=await q.updateHostService(n.id,{is_active:$});T?(u(K=>K.map(D=>D.id===n.id?{...D,is_active:n.is_active}:D)),console.error("Toggle active failed:",T),alert("Failed to update status: "+(T.message||"Unknown error"))):window.dispatchEvent(new CustomEvent("services:changed",{detail:{id:n.id,is_active:$}}))}finally{U(null)}},R=n=>{S(n)},y=()=>{S(null)},z=[...l.filter(n=>{var A,T,K,D;const $=!C||((A=n.service_name)==null?void 0:A.toLowerCase().includes(C.toLowerCase()))||((T=n.description)==null?void 0:T.toLowerCase().includes(C.toLowerCase()))||((K=n.city)==null?void 0:K.toLowerCase().includes(C.toLowerCase()))||((D=n.state)==null?void 0:D.toLowerCase().includes(C.toLowerCase())),G=f==="all"||f==="active"&&n.is_active||f==="inactive"&&!n.is_active||n.service_type===f;return $&&G})].sort((n,$)=>{switch(a){case"recent":return new Date($.created_at||0)-new Date(n.created_at||0);case"bookings":return($.total_bookings||0)-(n.total_bookings||0);case"rating":return($.rating||0)-(n.rating||0);case"name":return(n.service_name||"").localeCompare($.service_name||"");default:return 0}}),w=l.length,F=l.filter(n=>n.is_active).length,M=l.reduce((n,$)=>n+($.total_bookings||0),0),H=l.length>0?(l.reduce((n,$)=>n+($.rating||0),0)/l.length).toFixed(1):0;return P?e.jsx(ge,{service:P,onBack:y,onEdit:n=>t(`/dashboard/services/${n}/edit`),onDelete:k}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30 text-slate-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl md:text-5xl lg:text-6xl font-extrabold bg-gradient-to-r from-slate-900 via-slate-800 to-[var(--primary-color)] bg-clip-text text-transparent mb-3",children:"My Services"}),e.jsx("p",{className:"text-slate-600 text-base md:text-lg",children:"Manage and monitor your security service offerings"})]}),e.jsxs(ae,{to:"/dashboard/add-service",className:"inline-flex items-center gap-2 bg-gradient-to-r from-[var(--primary-color)] to-emerald-500 text-white px-6 py-3.5 rounded-xl font-bold shadow-lg hover:shadow-xl hover:shadow-emerald-300/50 transition-all duration-300 hover:scale-105 group",children:[e.jsx("span",{className:"material-symbols-outlined text-xl group-hover:rotate-90 transition-transform duration-300",children:"add"}),"Add New Service"]})]}),l.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-200/60 mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:"search"}),e.jsx("input",{type:"text",placeholder:"Search services by name, location, or description...",value:C,onChange:n=>j(n.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-slate-50/50"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:f,onChange:n=>s(n.target.value),className:"px-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-white font-medium text-slate-700",children:[e.jsx("option",{value:"all",children:"All Services"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"}),e.jsx("option",{value:"guards",children:"Guards"}),e.jsx("option",{value:"drones",children:"Drones"}),e.jsx("option",{value:"agencies",children:"Agencies"})]}),e.jsxs("select",{value:a,onChange:n=>v(n.target.value),className:"px-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-white font-medium text-slate-700",children:[e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"bookings",children:"Most Bookings"}),e.jsx("option",{value:"rating",children:"Highest Rating"}),e.jsx("option",{value:"name",children:"Name (A-Z)"})]})]})]}),C||f!=="all"?e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200",children:e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",e.jsx("span",{className:"font-bold text-slate-900",children:z.length})," of ",e.jsx("span",{className:"font-bold text-slate-900",children:l.length})," services"]})}):null]})]}),x&&e.jsx("div",{className:"bg-rose-50 border border-rose-200 rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-rose-500",children:"error"}),e.jsx("p",{className:"text-rose-700 text-sm",children:x})]})}),o&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-[var(--primary-color)] border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-slate-500",children:"Loading services..."})]})}),!o&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5 md:gap-6 mb-10",children:[e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-slate-50 border border-slate-200/80 shadow-lg hover:shadow-2xl hover:shadow-blue-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-xs font-semibold uppercase tracking-wider mb-2",children:"Total Services"}),e.jsx("p",{className:"text-4xl font-extrabold text-slate-900 mb-1",children:w}),e.jsx("p",{className:"text-xs text-slate-400",children:"All time"})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"security"})})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-emerald-50/50 border border-emerald-200/80 shadow-lg hover:shadow-2xl hover:shadow-emerald-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-emerald-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-emerald-600 text-xs font-semibold uppercase tracking-wider mb-2",children:"Active Services"}),e.jsx("p",{className:"text-4xl font-extrabold text-slate-900 mb-1",children:F}),e.jsxs("p",{className:"text-xs text-slate-400",children:[w>0?Math.round(F/w*100):0,"% of total"]})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"check_circle"})})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-sky-50/50 border border-sky-200/80 shadow-lg hover:shadow-2xl hover:shadow-sky-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-sky-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sky-600 text-xs font-semibold uppercase tracking-wider mb-2",children:"Total Bookings"}),e.jsx("p",{className:"text-4xl font-extrabold text-slate-900 mb-1",children:M.toLocaleString()}),e.jsx("p",{className:"text-xs text-slate-400",children:"All services"})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"event"})})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-amber-50/50 border border-amber-200/80 shadow-lg hover:shadow-2xl hover:shadow-amber-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-amber-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-600 text-xs font-semibold uppercase tracking-wider mb-2",children:"Avg Rating"}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("p",{className:"text-4xl font-extrabold text-slate-900",children:H}),e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-xl",children:"star"})]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Customer feedback"})]}),e.jsx("div",{className:"p-4 bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"star"})})]})]})]}),!o&&e.jsx(e.Fragment,{children:l.length===0?e.jsxs(E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-20 bg-white rounded-3xl border-2 border-dashed border-slate-300 shadow-lg",children:[e.jsx("div",{className:"w-32 h-32 bg-gradient-to-br from-[var(--primary-color)] via-emerald-400 to-sky-400 rounded-full flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-emerald-300/40 animate-pulse",children:e.jsx("span",{className:"material-symbols-outlined text-white text-5xl",children:"security"})}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900 mb-3",children:"No Services Yet"}),e.jsx("p",{className:"text-slate-500 mb-8 text-lg max-w-md mx-auto",children:"Start by adding your first security service offering and begin receiving bookings"}),e.jsxs(ae,{to:"/dashboard/add-service",className:"inline-flex items-center gap-3 bg-gradient-to-r from-[var(--primary-color)] to-emerald-500 text-white px-8 py-4 rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:shadow-emerald-300/40 transition-all duration-300 hover:scale-105",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"add"}),"Add Your First Service"]})]}):z.length===0?e.jsxs("div",{className:"text-center py-20 bg-white rounded-3xl border border-slate-200 shadow-lg",children:[e.jsx("div",{className:"text-6xl mb-6",children:"🔍"}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-3",children:"No Services Found"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Try adjusting your search or filter criteria"}),e.jsx("button",{onClick:()=>{j(""),s("all")},className:"px-6 py-3 bg-slate-900 text-white rounded-xl font-semibold hover:bg-slate-800 transition-all",children:"Clear Filters"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:z.map((n,$)=>{const G=N[n.service_type]||N.other,A=Math.min(n.total_bookings/20*100,100),T=m(n.sub_category);T&&Object.keys(T).length>0;const K=(r==null?void 0:r.company_name)||(r==null?void 0:r.full_name)||(h!=null&&h.email?h.email.split("@")[0]:"Host");return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:$*.05},className:"group relative overflow-hidden rounded-3xl bg-white border border-slate-200/80 shadow-lg hover:shadow-2xl hover:shadow-blue-200/20 transition-all duration-300 cursor-pointer",onClick:D=>{D.target.closest("button")||R(n)},whileHover:{y:-6,scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[var(--primary-color)]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"}),e.jsx("div",{className:"absolute top-5 right-5 z-20",children:e.jsx("div",{className:`px-3.5 py-1.5 rounded-full text-xs font-bold shadow-lg backdrop-blur-sm ${n.is_active?"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white border border-emerald-400":"bg-slate-100 text-slate-600 border border-slate-300"}`,children:e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${n.is_active?"bg-white":"bg-slate-400"} animate-pulse`}),n.is_active?"Active":"Inactive"]})})}),e.jsx("div",{className:"absolute top-5 left-5 z-20",children:e.jsx("div",{className:`px-3 py-1.5 rounded-full text-xs font-bold text-white shadow-lg bg-gradient-to-r ${G.color}`,children:G.label})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 rounded-2xl overflow-hidden shadow-xl border border-slate-100 group-hover:shadow-2xl transition-all duration-300",children:e.jsx(oe,{images:n.images||[],className:"w-full h-52 object-cover group-hover:scale-105 transition-transform duration-500"})}),e.jsxs("div",{className:"mb-5",children:[e.jsx("h3",{className:"text-2xl font-extrabold text-slate-900 mb-2 group-hover:text-[var(--primary-color)] transition-colors line-clamp-1",children:n.service_name||n.name||"Unnamed Service"}),e.jsx("p",{className:"text-slate-600 text-sm leading-relaxed line-clamp-2",children:n.description||"No description available"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-5 pb-5 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-lg",children:"star"}),e.jsx("span",{className:"font-bold text-slate-900",children:(n.rating||0).toFixed(1)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"event"}),e.jsxs("span",{className:"text-sm font-medium",children:[n.total_bookings||0," bookings"]})]}),n.city&&n.state&&e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 ml-auto",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"location_on"}),e.jsx("span",{className:"text-xs font-medium",children:n.city})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 border border-slate-200",children:[e.jsx("p",{className:"text-xs text-slate-500 font-medium mb-1",children:"Company"}),e.jsx("p",{className:"text-sm font-bold text-slate-900 truncate",children:K})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-3 border border-slate-200",children:[e.jsx("p",{className:"text-xs text-slate-500 font-medium mb-1",children:"Price"}),e.jsxs("p",{className:"text-sm font-bold text-[var(--primary-color)]",children:["₹",n.price_per_hour||n.price||"N/A",n.price_per_hour?"/hr":""]})]})]}),n.specializations&&n.specializations.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-slate-500 text-sm mb-3 font-medium",children:"Specializations:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.specializations.slice(0,3).map((D,Z)=>e.jsx("span",{className:"px-3 py-1 bg-[var(--primary-color)]/10 border border-[var(--primary-color)]/40 rounded-full text-xs text-[var(--primary-color)] font-medium",children:D},Z)),n.specializations.length>3&&e.jsxs("span",{className:"px-3 py-1 bg-[var(--primary-color)]/10 border border-[var(--primary-color)]/40 rounded-full text-xs text-[var(--primary-color)] font-medium",children:["+",n.specializations.length-3," more"]})]})]}),(()=>{const D=m(n.sub_category);return D&&Object.keys(D).length>0})()&&e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-slate-500 text-sm mb-3 font-medium",children:"Subcategories & Pricing:"}),e.jsx("div",{className:"space-y-2",children:Object.entries(m(n.sub_category)).map(([D,Z])=>e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 border border-slate-200 rounded-xl px-4 py-3",children:[e.jsx("span",{className:"text-slate-900 text-sm font-semibold",children:Z.label}),e.jsxs("span",{className:"text-[var(--primary-color)] font-bold text-sm",children:[Z.currency," ",Z.price_per_hour,"/hr"]})]},D))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"font-semibold text-slate-600",children:"Performance Score"}),e.jsxs("span",{className:"font-bold text-[var(--primary-color)]",children:[Math.round(A),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2.5 overflow-hidden shadow-inner",children:e.jsx(E.div,{className:"h-full bg-gradient-to-r from-[var(--primary-color)] via-emerald-400 to-sky-400 rounded-full shadow-lg",initial:{width:0},animate:{width:`${A}%`},transition:{duration:1.5,ease:"easeOut"}})})]}),e.jsxs("div",{className:"flex gap-2.5",children:[e.jsxs("button",{onClick:()=>R(n),className:"flex-1 bg-gradient-to-r from-slate-900 to-slate-800 text-white py-3 px-4 rounded-xl font-bold hover:from-slate-800 hover:to-slate-700 hover:shadow-xl hover:shadow-slate-400/40 transition-all duration-300 hover:scale-105 group border border-slate-700 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base mr-1.5 group-hover:scale-110 transition-transform inline-block",children:"visibility"}),"View"]}),e.jsxs("button",{onClick:D=>{D.stopPropagation(),t(`/dashboard/services/${n.id}/edit`)},className:"flex-1 bg-gradient-to-r from-amber-500 to-amber-600 text-white py-3 px-4 rounded-xl font-bold hover:from-amber-600 hover:to-amber-700 hover:shadow-xl hover:shadow-amber-300/40 transition-all duration-300 hover:scale-105 group border border-amber-400 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base mr-1.5 group-hover:rotate-12 transition-transform inline-block",children:"edit"}),"Edit"]}),e.jsx("button",{onClick:D=>{D.stopPropagation(),c(n)},disabled:O===n.id,className:`px-4 py-3 rounded-xl font-bold hover:shadow-xl transition-all duration-300 hover:scale-105 group border text-sm ${n.is_active?"bg-gradient-to-r from-rose-500 to-rose-600 text-white hover:from-rose-600 hover:to-rose-700 border-rose-400 hover:shadow-rose-300/40":"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:from-emerald-600 hover:to-emerald-700 border-emerald-400 hover:shadow-emerald-300/40"}`,children:e.jsx("span",{className:"material-symbols-outlined text-base group-hover:scale-110 transition-transform inline-block",children:n.is_active?"toggle_on":"toggle_off"})}),e.jsx("button",{onClick:D=>{D.stopPropagation(),_(n)},className:"px-4 py-3 bg-gradient-to-r from-rose-500 to-rose-600 text-white rounded-xl font-bold hover:from-rose-600 hover:to-rose-700 hover:shadow-xl hover:shadow-rose-300/40 transition-all duration-300 hover:scale-105 group border border-rose-400 text-sm",children:e.jsx("span",{className:"material-symbols-outlined text-base group-hover:scale-110 transition-transform",children:"delete"})})]})]})]},n.id)})})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx(E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl p-8 border border-rose-200 max-w-md w-full mx-4 shadow-[0_18px_60px_rgba(15,23,42,0.25)]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx("span",{className:"material-symbols-outlined text-rose-500 text-3xl",children:"warning"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Delete Service"}),e.jsxs("p",{className:"text-slate-600 mb-8 text-lg",children:['Are you sure you want to delete "',p.service_name||p.name||"this service",'"? This action cannot be undone.']}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>_(null),className:"flex-1 bg-slate-100 text-slate-800 py-3 px-6 rounded-xl font-semibold hover:bg-slate-200 transition-all duration-300",children:"Cancel"}),e.jsx("button",{onClick:()=>k(p.id),disabled:d,className:"flex-1 bg-rose-500 text-white py-3 px-6 rounded-xl font-semibold hover:bg-rose-600 hover:shadow-lg hover:shadow-rose-300/40 transition-all duration-300 disabled:opacity-50",children:d?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Deleting..."]}):"Delete"})]})]})})})]})})},fe=({className:t="",children:h})=>e.jsx("div",{className:`rounded-2xl p-6 border border-slate-200 bg-white shadow-[0_12px_40px_rgba(15,23,42,0.08)] ${t}`,children:h}),ve=({children:t,className:h="",...r})=>e.jsx("button",{...r,className:`bg-gradient-to-r from-[var(--primary-color)] via-emerald-400 to-[#2a5a3a] text-[#111714] px-6 py-3 rounded-full font-bold shadow-[0_10px_30px_rgba(74,222,128,0.25)] hover:shadow-[0_18px_40px_rgba(74,222,128,0.35)] transition-all duration-300 ${h}`,children:t}),ye=()=>{const{id:t}=de(),h=ee(),[r,l]=i.useState(null),[u,o]=i.useState(!0),[b,x]=i.useState(!1),[g,p]=i.useState(null),[_,d]=i.useState(""),[I,O]=i.useState(""),U=`{
  "security_guard": { "label": "Security Guard", "price_per_hour": 200, "availability": 10, "images": [] }
}`;i.useEffect(()=>{(async()=>{const{data:f,error:s}=await q.getHostServiceById(t);s&&p(s.message),l(f||null);try{const a=f==null?void 0:f.sub_category;if(a){const v=typeof a=="string"?JSON.parse(a):a;d(JSON.stringify(v,null,2))}else d("")}catch{d(String((f==null?void 0:f.sub_category)||""))}o(!1)})()},[t]);const P=j=>{const{name:f,value:s}=j.target;l(a=>({...a,[f]:s}))},S=()=>{l(j=>({...j,is_active:!j.is_active}))},C=async()=>{try{x(!0),p(null),O("");let j=null;if(_&&_.trim().length>0)try{const a=JSON.parse(_);j=JSON.stringify(a)}catch{O("Invalid JSON in subcategories");return}else j=null;const f={service_name:r.service_name,description:r.description,city:r.city,state:r.state,is_active:r.is_active,sub_category:j},{error:s}=await q.updateHostService(t,f);if(s){p(s.message);return}h("/dashboard/services")}finally{x(!1)}};return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"w-6 h-6 border-2 border-[var(--primary-color)] border-t-transparent rounded-full animate-spin"})}):r?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-slate-900 via-slate-800 to-[var(--primary-color)] bg-clip-text text-transparent mb-3",children:"Edit Service"}),e.jsx("p",{className:"text-slate-600 text-base md:text-lg",children:"Update your service details and settings"})]}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-red-500",children:"error"}),e.jsx("p",{className:"text-red-700 text-sm font-medium",children:g})]})}),e.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-lg p-6 md:p-8 max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900",children:"Service Name"}),e.jsx("input",{name:"service_name",value:r.service_name||"",onChange:P,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all",placeholder:"Enter service name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900",children:"Description"}),e.jsx("textarea",{name:"description",rows:4,value:r.description||"",onChange:P,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all resize-none",placeholder:"Describe your service..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900",children:"Subcategories (JSON)"}),I&&e.jsx("span",{className:"text-red-600 text-xs font-medium bg-red-50 px-2 py-1 rounded",children:I})]}),e.jsx("textarea",{rows:10,value:_,onChange:j=>{d(j.target.value),I&&O("")},placeholder:U,className:"w-full font-mono text-sm px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all min-h-[200px] resize-none"}),e.jsx("p",{className:"text-slate-500 text-xs mt-2",children:"💡 Tip: Provide valid JSON. Leave empty to remove subcategories."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900",children:"State"}),e.jsx("input",{name:"state",value:r.state||"",onChange:P,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all",placeholder:"Enter state"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-semibold text-slate-900",children:"City"}),e.jsx("input",{name:"city",value:r.city||"",onChange:P,className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all",placeholder:"Enter city"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!r.is_active,onChange:S,className:"w-5 h-5 rounded border-slate-300 text-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 cursor-pointer"}),e.jsx("label",{className:"text-slate-900 font-semibold cursor-pointer",children:"Active Service"}),e.jsx("span",{className:"ml-auto text-xs text-slate-500",children:r.is_active?"✅ Visible to customers":"❌ Hidden from customers"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200",children:[e.jsx("button",{type:"button",onClick:C,disabled:b,className:"flex-1 bg-gradient-to-r from-[var(--primary-color)] to-emerald-500 text-white py-3 px-6 rounded-xl font-bold hover:shadow-lg hover:shadow-emerald-300/40 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:b?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>h("/dashboard/services"),className:"px-6 py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-semibold hover:bg-slate-50 hover:border-slate-300 transition-all duration-300",children:"Cancel"})]})]})})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"text-6xl mb-4",children:"❌"}),e.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Service not found"}),e.jsx("p",{className:"text-slate-500",children:"The service you're looking for doesn't exist"})]})},je=({booking:t,onClose:h})=>t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 animate-fade-in",children:e.jsxs("div",{className:"w-full max-w-2xl bg-[#111714] border border-[#29382f] rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#29382f]",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Booking #",t.id]}),e.jsx("button",{onClick:h,className:"p-2 rounded-lg hover:bg-[#1a241e]",children:e.jsx("span",{className:"material-symbols-outlined",children:"close"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Service"}),e.jsx("p",{className:"font-medium",children:t.service_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Status"}),e.jsx("p",{className:"font-medium capitalize",children:t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Date & Time"}),e.jsx("p",{className:"font-medium",children:t.date?new Date(t.date).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Location"}),e.jsx("p",{className:"font-medium",children:(()=>{if(!t.location)return"—";if(typeof t.location=="string")return t.location||"—";const r=t.location||{};return r.address||[r.city,r.state].filter(Boolean).join(", ")||"—"})()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Started"}),e.jsx("p",{className:"font-medium",children:t.start_time?new Date(t.start_time).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Ended"}),e.jsx("p",{className:"font-medium",children:t.end_time?new Date(t.end_time).toLocaleString():"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["₹",Number(t.price||0).toLocaleString("en-IN")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:"Payment"}),e.jsx("p",{className:"font-medium capitalize",children:t.payment_status||"—"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm mb-1",children:"Notes"}),e.jsx("p",{className:"whitespace-pre-wrap bg-[#0b100e] border border-[#29382f] rounded-xl p-4",children:t.user_notes||"—"})]})]})]})}):null,Ne=()=>{const{user:t}=V(),[h,r]=i.useState([]),[l,u]=i.useState(!0),[o,b]=i.useState(null),[x,g]=i.useState(""),[p,_]=i.useState("all"),[d,I]=i.useState(null),[O,U]=i.useState(null),P=s=>{const a=(s||"").toLowerCase();return a==="confirmed"?"bg-emerald-500/15 text-emerald-400 border-emerald-500/30":a==="completed"?"bg-sky-500/15 text-sky-400 border-sky-500/30":a==="pending"?"bg-amber-500/15 text-amber-400 border-amber-500/30":a==="cancelled"?"bg-rose-500/15 text-rose-400 border-rose-500/30":"bg-white/5 text-white/70 border-white/10"},S=s=>{const a=(s||"").toLowerCase();return a==="paid"?"bg-emerald-500/15 text-emerald-400 border-emerald-500/30":a==="pending"?"bg-amber-500/15 text-amber-400 border-amber-500/30":a==="failed"?"bg-rose-500/15 text-rose-400 border-rose-500/30":"bg-white/5 text-white/70 border-white/10"};i.useEffect(()=>{(async()=>{if(!(t!=null&&t.id))return;u(!0),b(null);const{data:a,error:v}=await q.getHostBookings(t.id);v&&b(v.message);let m=a||[];const N=Array.from(new Set(m.map(k=>k.user_id).filter(Boolean)));if(N.length){const{data:k,error:c}=await B.from("profiles").select("id, full_name").in("id",N);if(!c&&k){const R=new Map(k.map(y=>[y.id,y.full_name]));m=m.map(y=>({...y,user_name:R.get(y.user_id)||"Customer"}))}}r(m),u(!1)})()},[t==null?void 0:t.id]);const C=i.useMemo(()=>(h||[]).filter(s=>{const a=typeof s.location=="string"?s.location:s.location&&(s.location.address||[s.location.city,s.location.state].filter(Boolean).join(", "))||"",v=x?String(s.id).includes(x)||(s.service_type||"").toLowerCase().includes(x.toLowerCase())||(s.user_name||"").toLowerCase().includes(x.toLowerCase())||a.toLowerCase().includes(x.toLowerCase()):!0,m=p==="all"?!0:(s.status||"").toLowerCase()===p;return v&&m}),[h,x,p]),j=s=>s?`#${String(s).slice(-6)}`:"—",f=async s=>{try{await navigator.clipboard.writeText(String(s)),U(s),setTimeout(()=>U(null),1200)}catch{}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-slate-900 via-slate-800 to-[var(--primary-color)] bg-clip-text text-transparent mb-3",children:"Bookings"}),e.jsx("p",{className:"text-slate-600 text-base md:text-lg",children:"Manage and track all your service bookings"})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-200/60",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:"search"}),e.jsx("input",{value:x,onChange:s=>g(s.target.value),placeholder:"Search by ID, service, location, customer...",className:"w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-slate-50/50"})]}),e.jsxs("select",{value:p,onChange:s=>_(s.target.value),className:"px-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-white font-medium text-slate-700",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-slate-200",children:["pending","confirmed","completed","cancelled"].map(s=>e.jsxs("button",{onClick:()=>_(a=>a===s?"all":s),className:`px-4 py-2 rounded-full text-xs font-semibold border transition-all ${p===s?"bg-gradient-to-r from-[var(--primary-color)] to-emerald-500 text-white border-transparent shadow-lg":"bg-white border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm align-middle mr-1.5",children:s==="pending"?"hourglass_top":s==="confirmed"?"event_available":s==="completed"?"check_circle":"cancel"}),s.charAt(0).toUpperCase()+s.slice(1)]},s))})]})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-lg overflow-hidden",children:l?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-[var(--primary-color)] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Loading bookings..."})]}):C.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📋"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No bookings found"}),e.jsx("p",{className:"text-slate-500",children:"Try adjusting your search or filter criteria"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 p-6",children:C.map(s=>e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"group relative overflow-hidden rounded-3xl bg-white border border-slate-200/80 shadow-lg hover:shadow-2xl hover:shadow-blue-200/20 transition-all duration-300 cursor-pointer",whileHover:{y:-4,scale:1.01},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[var(--primary-color)]/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"}),e.jsx("div",{className:"absolute top-5 right-5 z-10",children:e.jsx("span",{className:`px-3.5 py-1.5 rounded-full text-xs font-bold shadow-lg backdrop-blur-sm border ${P(s.status)}`,children:s.status||"—"})}),e.jsxs("div",{className:"p-6 pb-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-[var(--primary-color)] to-emerald-500 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"shield_person"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg capitalize text-slate-900",children:s.service_type||"Service"}),e.jsxs("button",{className:"text-xs text-slate-500 hover:text-slate-700 transition-colors font-medium",title:"Click to copy full ID",onClick:a=>{a.stopPropagation(),f(s.id)},children:[j(s.id),O===s.id?" • Copied!":""]})]})]})}),e.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium mb-1",children:"Total Price"}),e.jsxs("div",{className:"text-2xl font-extrabold text-slate-900",children:["₹",Number(s.price||0).toLocaleString("en-IN")]})]})]}),e.jsxs("div",{className:"px-6 pb-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg",children:"person"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Customer"}),e.jsx("div",{className:"truncate text-slate-900 font-semibold",title:s.user_name||"",children:s.user_name||"Customer"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg",children:"schedule"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Booking Date"}),e.jsx("div",{className:"text-slate-900 font-semibold",children:s.date?new Date(s.date).toLocaleDateString():"—"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("span",{className:"material-symbols-outlined text-slate-500 text-lg",children:"location_on"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Location"}),e.jsx("div",{className:"truncate text-slate-900 font-semibold",title:(()=>{if(!s.location)return"—";if(typeof s.location=="string")return s.location||"—";const a=s.location||{};return a.address||[a.city,a.state].filter(Boolean).join(", ")||"—"})(),children:(()=>{if(!s.location)return"—";if(typeof s.location=="string")return s.location||"—";const a=s.location||{};return a.address||[a.city,a.state].filter(Boolean).join(", ")||"—"})()})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-2 border-t border-slate-200",children:[e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-xs font-semibold capitalize ${S(s.payment_status)}`,children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:(()=>{const a=(s.payment_status||"").toLowerCase();return a==="paid"?"verified":a==="pending"?"schedule":a==="failed"?"error":"payments"})()}),s.payment_status||"—"]}),e.jsxs("button",{className:"ml-auto inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-gradient-to-r from-slate-900 to-slate-800 text-white hover:from-slate-800 hover:to-slate-700 transition-all text-sm font-semibold shadow-lg hover:shadow-xl",onClick:a=>{a.stopPropagation(),I(s)},children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"visibility"}),"View Details"]})]})]})]},s.id))})}),e.jsx(je,{booking:d,onClose:()=>I(null)})]})},we=async(t,h,r)=>{try{if(console.log("Uploading images for service:",t,"host:",h),!r||r.length===0)return[];const l=[];for(let u=0;u<r.length;u++){const o=r[u];if(!o.type.startsWith("image/"))throw new Error(`File ${o.name} is not an image`);if(o.size>5*1024*1024)throw new Error(`File ${o.name} is too large. Maximum size is 5MB`);const b=o.name.split(".").pop(),x=`${Date.now()}-${Math.random().toString(36).substring(2)}.${b}`,g=`${h}/${t}/${x}`;console.log("Uploading file:",g);const{data:p,error:_}=await B.storage.from("service-images").upload(g,o,{cacheControl:"3600",upsert:!1});if(_)throw console.error("Upload error:",_),new Error(`Failed to upload ${o.name}: ${_.message}`);const{data:{publicUrl:d}}=B.storage.from("service-images").getPublicUrl(g);l.push(d),console.log("Uploaded successfully:",d)}return l}catch(l){throw console.error("Error uploading images:",l),l}},_e=async(t,h)=>{try{console.log("Updating service images:",t,h);const{data:r,error:l}=await B.from("host_services").update({images:h}).eq("id",t).select();if(l)throw console.error("Update error:",l),new Error(`Failed to update service images: ${l.message}`);return console.log("Service images updated successfully:",r),r}catch(r){throw console.error("Error updating service images:",r),r}},Se=async(t,h,r,l)=>{console.log("🔍 uploadGuardTypeImages called with:",{serviceId:t,hostId:h,subcategoryKey:r,filesCount:l==null?void 0:l.length});try{if(!l||l.length===0)return console.log("⚠️ No files provided to uploadGuardTypeImages"),[];console.log("🚀 Proceeding with upload to guard_services bucket...");const u=[];for(let o=0;o<l.length;o++){const b=l[o];if(console.log(`📸 Processing file ${o+1}/${l.length}:`,b.name,b.type,b.size),!b.type.startsWith("image/"))throw new Error(`File ${b.name} is not an image`);if(b.size>5*1024*1024)throw new Error(`File ${b.name} is too large. Maximum size is 5MB`);const x=b.name.split(".").pop(),g=`${Date.now()}-${Math.random().toString(36).substring(2)}.${x}`,p=`${h}/${t}/${r}/${g}`;console.log(`📁 Upload path: ${p}`);const{data:_,error:d}=await B.storage.from("guard_services").upload(p,b,{cacheControl:"3600",upsert:!1});if(d)throw console.error("❌ Upload error for",b.name,":",d),new Error(`Failed to upload ${b.name}: ${d.message}`);console.log(`✅ Upload successful for ${b.name}:`,_);const{data:I,error:O}=await B.storage.from("guard_services").createSignedUrl(p,60*60*24*365);if(O)throw console.error("❌ Error creating signed URL for",b.name,":",O),new Error(`Failed to create signed URL for ${b.name}: ${O.message}`);console.log(`🔗 Signed URL for ${b.name}:`,I.signedUrl),u.push(p)}return console.log(`🎉 Successfully uploaded ${u.length} images to guard_services`),u}catch(u){throw console.error("❌ Error uploading guard type images:",u),console.error("❌ Error details:",JSON.stringify(u,null,2)),u}},ke=t=>{const h=[],l=["image/jpeg","image/png","image/webp","image/gif"];for(let u of t)l.includes(u.type)||h.push(`${u.name}: Only JPEG, PNG, WebP, and GIF images are allowed`),u.size>5242880&&h.push(`${u.name}: File size must be less than 5MB`);return h};async function ne(){console.log("🔍 Checking available storage buckets...");try{if(typeof navigator<"u"&&navigator.onLine===!1)return console.warn("⚠️ Offline detected, skipping bucket checks."),{success:!1,error:new Error("offline")};console.log("🔐 Checking authentication...");const{data:{user:t},error:h}=await B.auth.getUser();if(h||!t)return console.error("❌ Auth error:",h),{success:!1,error:h||new Error("no-user")};console.log("👤 Current user:",t==null?void 0:t.id);const{data:r,error:l}=await B.storage.listBuckets();if(l)return console.error("❌ Error listing buckets:",l),{success:!1,error:l};console.log("📦 Available buckets:",r),console.log("📊 Bucket count:",(r==null?void 0:r.length)||0);const u=r==null?void 0:r.find(o=>o.name==="guard_services");if(u){console.log("✅ guard_services bucket found:",u);const{data:o,error:b}=await B.storage.from("guard_services").list("",{limit:10});b?console.error("❌ Error listing files in guard_services:",b):console.log("📁 Files in guard_services bucket:",o)}else{console.log("❌ guard_services bucket NOT found"),console.log("Available bucket names:",r==null?void 0:r.map(x=>x.name)),console.log("🔍 Attempting direct access to guard_services bucket...");const{data:o,error:b}=await B.storage.from("guard_services").list("",{limit:1});b?console.error("❌ Direct access failed:",b):console.log("✅ Direct access successful! Bucket exists but not in list:",o)}return{success:!0,buckets:r,guardServicesExists:!!u,user:t==null?void 0:t.id}}catch(t){return console.error("❌ Unexpected error checking buckets:",t),{success:!1,error:t}}}async function Ce(){console.log("🧪 Testing guard_services upload...");try{const t=new File(["test content"],"test.txt",{type:"text/plain"}),{data:h,error:r}=await B.storage.from("guard_services").upload("test/test.txt",t);return r?(console.error("❌ Upload test failed:",r),{success:!1,error:r}):(console.log("✅ Upload test successful:",h),await B.storage.from("guard_services").remove(["test/test.txt"]),{success:!0,data:h})}catch(t){return console.error("❌ Upload test error:",t),{success:!1,error:t}}}typeof window<"u"&&navigator.onLine&&ne().then(t=>{t&&t.success&&t.guardServicesExists&&Ce()}).catch(()=>{});const re=({images:t=[],onImagesChange:h,maxImages:r=5,disabled:l=!1})=>{const[u,o]=i.useState(!1),[b,x]=i.useState(!1),[g,p]=i.useState(null),_=i.useRef(null),d=j=>{const f=Array.from(j);if(t.length+f.length>r){p(`Maximum ${r} images allowed. You can add ${r-t.length} more.`);return}const s=ke(f);if(s.length>0){p(s.join(", "));return}p(null),h([...t,...f])},I=j=>{if(j.preventDefault(),o(!1),l)return;const f=j.dataTransfer.files;d(f)},O=j=>{j.preventDefault(),l||o(!0)},U=j=>{j.preventDefault(),o(!1)},P=j=>{const f=j.target.files;f.length>0&&d(f),j.target.value=""},S=j=>{const f=t.filter((s,a)=>a!==j);h(f),p(null)},C=()=>{var j;l||(j=_.current)==null||j.click()};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-6 text-center transition-all duration-300 cursor-pointer ${u?"border-[var(--primary-color)] bg-[var(--primary-color)]/10":"border-[#29382f] hover:border-[var(--primary-color)]/50"} ${l?"opacity-50 cursor-not-allowed":""}`,onDrop:I,onDragOver:O,onDragLeave:U,onClick:C,children:[e.jsx("input",{ref:_,type:"file",multiple:!0,accept:"image/*",onChange:P,className:"hidden",disabled:l}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-gradient-to-br from-[var(--primary-color)] to-[#2a5a3a] rounded-full flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-[#111714] text-xl",children:b?"hourglass_empty":"add_photo_alternate"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:b?"Uploading...":"Upload Service Images"}),e.jsx("p",{className:"text-white/60 text-sm mt-1",children:"Drag & drop images here or click to browse"}),e.jsxs("p",{className:"text-white/40 text-xs mt-1",children:["Max ",r," images, 5MB each (JPEG, PNG, WebP, GIF)"]})]})]})]}),g&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-red-400 text-sm",children:"error"}),e.jsx("p",{className:"text-red-400 text-sm",children:g})]})}),t.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-white font-medium",children:["Selected Images (",t.length,"/",r,")"]}),!l&&e.jsx("button",{onClick:C,className:"text-[var(--primary-color)] hover:text-[#2a5a3a] text-sm font-medium transition-colors",children:"Add More"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:t.map((j,f)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-[#29382f]",children:typeof j=="string"?e.jsx("img",{src:j,alt:`Service image ${f+1}`,className:"w-full h-full object-cover",onError:s=>{s.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMjkzODJmIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iI2ZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlPC90ZXh0Pjwvc3ZnPg=="}}):e.jsx("img",{src:URL.createObjectURL(j),alt:`Preview ${f+1}`,className:"w-full h-full object-cover"})}),!l&&e.jsx("button",{onClick:()=>S(f),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200 hover:scale-110","aria-label":"Remove image",children:e.jsx("span",{className:"material-symbols-outlined text-xs",children:"close"})})]},f))})]})]})},Ie=()=>{var z;const t=ee(),{user:h,hostProfile:r}=V(),[l,u]=i.useState(!1),[o,b]=i.useState(null),[x,g]=i.useState({name:"",description:"",service_type:"",state:"",city:"",specializations:"",equipment_included:"",is_active:!0}),[p,_]=i.useState([]),[d,I]=i.useState({}),[O,U]=i.useState({name:"",price:""}),P=[{value:"guards",label:"Guards"},{value:"drones",label:"Drones"},{value:"agencies",label:"Agencies"}],S={guards:[{value:"night_guard",label:"Night Guard"},{value:"day_guard",label:"Day Guard"},{value:"male_guard",label:"Male Guard"},{value:"female_guard",label:"Female Guard"},{value:"bouncer",label:"Bouncer"},{value:"event_security",label:"Event Security"},{value:"emergency_response",label:"Emergency Response"},{value:"corporate_security",label:"Corporate Security"},{value:"industrial_security",label:"Industrial Security"},{value:"personal_bodyguard",label:"Personal Bodyguard"},{value:"other",label:"Other (Custom)"}],drones:[{value:"surveillance_drone",label:"Surveillance Drone"},{value:"patrol_drone",label:"Patrol Drone"},{value:"event_monitoring",label:"Event Monitoring"},{value:"other",label:"Other (Custom)"}],agencies:[{value:"security_agency",label:"Security Agency"},{value:"investigation_agency",label:"Investigation Agency"},{value:"consulting_agency",label:"Security Consulting"},{value:"other",label:"Other (Custom)"}]},C="w-full px-4 py-3 bg-white border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)]/20 transition-all duration-300",j=`${C} resize-none`,f="flex-1 px-3 py-2 bg-white border border-slate-200 rounded text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:outline-none focus:ring-1 focus:ring-[var(--primary-color)]/20 text-sm transition-all duration-300",s=[{value:"Andhra Pradesh",label:"Andhra Pradesh"},{value:"Arunachal Pradesh",label:"Arunachal Pradesh"},{value:"Assam",label:"Assam"},{value:"Bihar",label:"Bihar"},{value:"Chhattisgarh",label:"Chhattisgarh"},{value:"Goa",label:"Goa"},{value:"Gujarat",label:"Gujarat"},{value:"Haryana",label:"Haryana"},{value:"Himachal Pradesh",label:"Himachal Pradesh"},{value:"Jharkhand",label:"Jharkhand"},{value:"Karnataka",label:"Karnataka"},{value:"Kerala",label:"Kerala"},{value:"Madhya Pradesh",label:"Madhya Pradesh"},{value:"Maharashtra",label:"Maharashtra"},{value:"Manipur",label:"Manipur"},{value:"Meghalaya",label:"Meghalaya"},{value:"Mizoram",label:"Mizoram"},{value:"Nagaland",label:"Nagaland"},{value:"Odisha",label:"Odisha"},{value:"Punjab",label:"Punjab"},{value:"Rajasthan",label:"Rajasthan"},{value:"Sikkim",label:"Sikkim"},{value:"Tamil Nadu",label:"Tamil Nadu"},{value:"Telangana",label:"Telangana"},{value:"Tripura",label:"Tripura"},{value:"Uttar Pradesh",label:"Uttar Pradesh"},{value:"Uttarakhand",label:"Uttarakhand"},{value:"West Bengal",label:"West Bengal"},{value:"Delhi",label:"Delhi"},{value:"Jammu and Kashmir",label:"Jammu and Kashmir"},{value:"Ladakh",label:"Ladakh"},{value:"Puducherry",label:"Puducherry"},{value:"Chandigarh",label:"Chandigarh"},{value:"Andaman and Nicobar Islands",label:"Andaman and Nicobar Islands"},{value:"Dadra and Nagar Haveli and Daman and Diu",label:"Dadra and Nagar Haveli and Daman and Diu"},{value:"Lakshadweep",label:"Lakshadweep"}],a={"Andhra Pradesh":["Visakhapatnam","Vijayawada","Guntur","Nellore","Kurnool","Tirupati","Kadapa","Anantapur","Chittoor","Rajahmundry"],"Arunachal Pradesh":["Itanagar","Naharlagun","Pasighat","Tezpur","Dibrugarh","Tinsukia","Jorhat","Sibsagar","North Lakhimpur","Bongaigaon"],Assam:["Guwahati","Silchar","Dibrugarh","Jorhat","Nagaon","Tinsukia","Tezpur","Bongaigaon","Dhubri","Diphu"],Bihar:["Patna","Gaya","Bhagalpur","Muzaffarpur","Darbhanga","Purnia","Arrah","Begusarai","Katihar","Munger"],Chhattisgarh:["Raipur","Bhilai","Bilaspur","Korba","Rajnandgaon","Durg","Raigarh","Ambikapur","Mahasamund","Bastar"],Goa:["Panaji","Margao","Vasco da Gama","Mapusa","Ponda","Mormugao","Bicholim","Sanguem","Canacona","Pernem"],Gujarat:["Ahmedabad","Surat","Vadodara","Rajkot","Bhavnagar","Jamnagar","Junagadh","Gandhinagar","Nadiad","Morbi"],Haryana:["Faridabad","Gurgaon","Panipat","Ambala","Yamunanagar","Rohtak","Hisar","Karnal","Sonipat","Panchkula"],"Himachal Pradesh":["Shimla","Dharamshala","Solan","Mandi","Palampur","Kullu","Manali","Chamba","Baddi","Una"],Jharkhand:["Ranchi","Jamshedpur","Dhanbad","Bokaro","Deoghar","Phusro","Hazaribagh","Giridih","Ramgarh","Medininagar"],Karnataka:["Bangalore","Mysore","Hubli","Mangalore","Belgaum","Gulbarga","Davanagere","Bellary","Bijapur","Shimoga"],Kerala:["Thiruvananthapuram","Kochi","Kozhikode","Thrissur","Kollam","Palakkad","Malappuram","Kannur","Kasaragod","Alappuzha"],"Madhya Pradesh":["Bhopal","Indore","Gwalior","Jabalpur","Ujjain","Sagar","Dewas","Satna","Ratlam","Rewa"],Maharashtra:["Mumbai","Pune","Nagpur","Thane","Nashik","Aurangabad","Solapur","Amravati","Kolhapur","Sangli"],Manipur:["Imphal","Thoubal","Bishnupur","Churachandpur","Senapati","Tamenglong","Chandel","Ukhrul","Kakching","Jiribam"],Meghalaya:["Shillong","Tura","Jowai","Nongstoin","Baghmara","Williamnagar","Nongpoh","Mairang","Khliehriat","Resubelpara"],Mizoram:["Aizawl","Lunglei","Saiha","Champhai","Kolasib","Serchhip","Lawngtlai","Mamit","Saitual","Hnahthial"],Nagaland:["Kohima","Dimapur","Mokokchung","Tuensang","Wokha","Mon","Phek","Zunheboto","Kiphire","Longleng"],Odisha:["Bhubaneswar","Cuttack","Rourkela","Berhampur","Sambalpur","Puri","Balasore","Bhadrak","Baripada","Jharsuguda"],Punjab:["Ludhiana","Amritsar","Jalandhar","Patiala","Bathinda","Mohali","Firozpur","Batala","Pathankot","Moga"],Rajasthan:["Jaipur","Jodhpur","Udaipur","Kota","Bikaner","Ajmer","Bharatpur","Alwar","Bhilwara","Ganganagar"],Sikkim:["Gangtok","Namchi","Mangan","Gyalshing","Singtam","Rangpo","Jorethang","Pakyong","Ravangla","Lachen"],"Tamil Nadu":["Chennai","Coimbatore","Madurai","Tiruchirappalli","Salem","Tirunelveli","Tiruppur","Erode","Vellore","Thoothukkudi"],Telangana:["Hyderabad","Warangal","Nizamabad","Khammam","Karimnagar","Ramagundam","Mahbubnagar","Nalgonda","Adilabad","Suryapet"],Tripura:["Agartala","Dharmanagar","Udaipur","Ambassa","Kailashahar","Belonia","Khowai","Teliamura","Sabroom","Amarpur"],"Uttar Pradesh":["Lucknow","Kanpur","Agra","Varanasi","Meerut","Allahabad","Bareilly","Ghaziabad","Moradabad","Aligarh"],Uttarakhand:["Dehradun","Haridwar","Roorkee","Kashipur","Rudrapur","Haldwani","Rishikesh","Ramnagar","Pithoragarh","Srinagar"],"West Bengal":["Kolkata","Asansol","Siliguri","Durgapur","Bardhaman","Malda","Baharampur","Habra","Kharagpur","Shantipur"],Delhi:["New Delhi","Central Delhi","East Delhi","North Delhi","North East Delhi","North West Delhi","Shahdara","South Delhi","South East Delhi","South West Delhi","West Delhi"],"Jammu and Kashmir":["Srinagar","Jammu","Anantnag","Baramulla","Sopore","Kathua","Udhampur","Punch","Rajauri","Doda"],Ladakh:["Leh","Kargil","Drass","Nubra","Zanskar","Changthang","Suru","Sham","Nubra Valley","Hemis"],Puducherry:["Puducherry","Karaikal","Mahe","Yanam"],Chandigarh:["Chandigarh"],"Andaman and Nicobar Islands":["Port Blair","Diglipur","Mayabunder","Rangat","Hut Bay","Car Nicobar","Nancowry","Katchal","Teressa","Campbell Bay"],"Dadra and Nagar Haveli and Daman and Diu":["Silvassa","Daman","Diu"],Lakshadweep:["Kavaratti","Agatti","Amini","Andrott","Kadmat","Kalpeni","Kiltan","Minicoy","Chetlat","Bitra"]},v=w=>{const{name:F,value:M,type:H,checked:n}=w.target;g($=>({...$,[F]:H==="checkbox"?n:M,...F==="state"&&{city:""},...F==="service_type"&&{subcategories:{}}})),F==="service_type"&&(I({}),U({name:"",price:""})),o&&b(null)},m=(w,F)=>{I(M=>{const H={...M};return F?H[w]={selected:!0,availability:"",images:[]}:delete H[w],H})},N=(w,F)=>{I(M=>({...M,[w]:{...M[w],availability:F}}))},k=(w,F)=>{I(M=>({...M,[w]:{...M[w],images:F}}))},c=(w,F)=>{I(M=>{var H;return{...M,[w]:{...M[w],pricingEnabled:F,price:F&&((H=M[w])==null?void 0:H.price)||""}}})},R=(w,F)=>{I(M=>({...M,[w]:{...M[w],price:F}}))},y=(w,F)=>{U(M=>({...M,[w]:F}))},L=async w=>{w.preventDefault(),u(!0),b(null);try{const{data:F,error:M}=await q.getHostServices(h.id);if(M){console.error("Error fetching existing services:",M),b("Failed to check existing services. Please try again.");return}const H=F==null?void 0:F.find(D=>D.service_type===x.service_type);if(H){b(`You already have a ${x.service_type} service named "${H.service_name}". Each service type can only be added once.`);return}const n=x.specializations.split(",").map(D=>D.trim()).filter(D=>D.length>0),$=x.equipment_included.split(",").map(D=>D.trim()).filter(D=>D.length>0),G={};if(Object.entries(d).forEach(([D,Z])=>{var te,W;if(Z!=null&&Z.selected){const Q=((W=(te=S[x.service_type])==null?void 0:te.find(X=>X.value===D))==null?void 0:W.label)||D;G[D]={label:Q,enabled:!0,availability:Number(Z.availability||0)||0,images:[]},Z.pricingEnabled&&Z.price&&(G[D].price_per_hour=parseFloat(Z.price))}}),x.service_type==="guards"&&!Object.values(G).some(Z=>Z.enabled&&Z.availability>0)){b("Please enable at least one guard type and set availability > 0.");return}const A={service_name:x.name,description:x.description,service_type:x.service_type,state:x.state,city:x.city,specializations:n,equipment_included:$,sub_category:JSON.stringify(G),is_active:x.is_active};console.log("Adding service:",A);const{data:T,error:K}=await q.addHostService(h.id,A);if(K){console.error("Error adding service:",K),b(K.message);return}if(console.log("Service added successfully:",T),p.length>0)try{console.log("Uploading images...");const D=await we(T[0].id,h.id,p);console.log("Images uploaded:",D),await _e(T[0].id,D),console.log("Service updated with images")}catch(D){console.error("Error uploading images:",D),b(`Service created but image upload failed: ${D.message}`)}if(x.service_type==="guards"){console.log("🔍 Guard service detected, processing subcategory images..."),console.log("📋 Raw subcategories state:",d),console.log("📋 Processed subcategories:",G);const D={...G};let Z=0;for(const[W,Q]of Object.entries(d))if(console.log(`🔍 Checking subcategory: ${W}`,Q),Q!=null&&Q.selected&&Array.isArray(Q.images)&&Q.images.length>0){console.log(`📸 Uploading ${Q.images.length} images for subcategory: ${W}`);try{const X=await Se(T[0].id,h.id,W,Q.images);console.log(`✅ Uploaded images for ${W}:`,X),D[W]&&(D[W].images=X,Z+=X.length)}catch(X){console.error(`❌ Guard type image upload failed for ${W}:`,X),console.error("❌ Upload error details:",JSON.stringify(X,null,2))}}else console.log(`⚠️ Skipping subcategory ${W} - not selected or no images`);console.log(`📊 Total images uploaded: ${Z}`),console.log("📋 Final subcategories with images:",JSON.stringify(D,null,2));const{error:te}=await q.updateHostService(T[0].id,{sub_category:JSON.stringify(D)});te?console.error("❌ Failed to update service with image URLs:",te):console.log("✅ Service updated with image URLs successfully")}t("/dashboard/services")}catch(F){console.error("Exception adding service:",F),b(F.message||"Failed to add service")}finally{u(!1)}};return e.jsxs("div",{className:"space-y-8 animate-fade-in-up",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold gradient-text animate-slide-in-left",children:"Add New Service"}),e.jsx("p",{className:"text-slate-600 mt-2 animate-slide-in-left",style:{animationDelay:"0.1s"},children:"Create a new security service offering"})]})}),o&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-4 backdrop-blur-sm animate-slide-in-top",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-red-400",children:"error"}),e.jsx("p",{className:"text-red-400 text-sm",children:o})]})}),e.jsx(fe,{className:"max-w-2xl",children:e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-slate-700",children:"Service Name *"}),e.jsx("input",{type:"text",id:"name",name:"name",value:x.name,onChange:v,className:C,placeholder:"e.g., Event Security, Bodyguard Protection",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-slate-700",children:"Description *"}),e.jsx("textarea",{id:"description",name:"description",value:x.description,onChange:v,rows:4,className:j,placeholder:"Describe your service in detail, including what clients can expect...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"service_type",className:"block text-sm font-medium text-slate-700",children:"Service Type *"}),e.jsxs("select",{id:"service_type",name:"service_type",value:x.service_type,onChange:v,className:C,required:!0,children:[e.jsx("option",{value:"",children:"Select service type"}),P.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))]})]}),x.service_type&&S[x.service_type]&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Select Subcategories with Pricing *"}),e.jsxs("div",{className:"space-y-4 bg-slate-50 border border-slate-200 rounded-lg p-4",children:[S[x.service_type].map(w=>{var F,M,H,n,$,G,A;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:`subcategory_${w.value}`,checked:((F=d[w.value])==null?void 0:F.selected)||!1,onChange:T=>m(w.value,T.target.checked),className:"w-4 h-4 text-[var(--primary-color)] bg-white border-slate-300 rounded focus:ring-[var(--primary-color)] focus:ring-2"}),e.jsx("label",{htmlFor:`subcategory_${w.value}`,className:"text-slate-800 text-sm font-medium",children:w.label})]}),((M=d[w.value])==null?void 0:M.selected)&&e.jsxs("div",{className:"ml-7 space-y-3",children:[w.value==="other"&&e.jsx("input",{type:"text",placeholder:"Custom subcategory name",value:O.name,onChange:T=>y("name",T.target.value),className:"w-full px-3 py-2 bg-white border border-slate-200 rounded text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:outline-none focus:ring-1 focus:ring-[var(--primary-color)]/20 transition-all duration-300 text-sm"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-slate-600 text-sm whitespace-nowrap",children:"Availability"}),e.jsx("input",{type:"number",min:"0",placeholder:"0",value:((H=d[w.value])==null?void 0:H.availability)||"",onChange:T=>N(w.value,T.target.value),className:f})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-slate-600 text-sm block mb-1",children:"Images"}),e.jsx(re,{images:((n=d[w.value])==null?void 0:n.images)||[],onImagesChange:T=>k(w.value,T),maxImages:3,disabled:l})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:`pricing_${w.value}`,checked:(($=d[w.value])==null?void 0:$.pricingEnabled)||!1,onChange:T=>c(w.value,T.target.checked),className:"w-4 h-4 text-[var(--primary-color)] bg-white border-slate-300 rounded focus:ring-[var(--primary-color)] focus:ring-2"}),e.jsx("label",{htmlFor:`pricing_${w.value}`,className:"text-slate-800 text-sm",children:"Enable hourly pricing"}),((G=d[w.value])==null?void 0:G.pricingEnabled)&&e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"₹"}),e.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"Price / hour",value:((A=d[w.value])==null?void 0:A.price)||"",onChange:T=>R(w.value,T.target.value),className:"w-32 px-3 py-2 bg-white border border-slate-200 rounded text-slate-900 placeholder-slate-400 focus:border-[var(--primary-color)] focus:outline-none focus:ring-1 focus:ring-[var(--primary-color)]/20 transition-all duration-300 text-sm"}),e.jsx("span",{className:"text-slate-500 text-sm",children:"/hour"})]})]})]})]},w.value)}),e.jsx("div",{className:"mt-4 p-3 bg-slate-100 rounded-lg border border-slate-200",children:e.jsx("p",{className:"text-slate-600 text-xs",children:"💡 Select the subcategories you offer and set individual pricing for each. This allows clients to choose specific services with transparent pricing."})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"state",className:"block text-sm font-medium text-slate-700",children:"State *"}),e.jsxs("select",{id:"state",name:"state",value:x.state,onChange:v,className:C,required:!0,children:[e.jsx("option",{value:"",children:"Select State"}),s.map(w=>e.jsx("option",{value:w.value,children:w.label},w.value))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-slate-700",children:"City *"}),e.jsxs("select",{id:"city",name:"city",value:x.city,onChange:v,disabled:!x.state,className:`${C} disabled:opacity-50 disabled:cursor-not-allowed`,required:!0,children:[e.jsx("option",{value:"",children:"Select City"}),x.state&&((z=a[x.state])==null?void 0:z.map(w=>e.jsx("option",{value:w,children:w},w)))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"specializations",className:"block text-sm font-medium text-slate-700",children:"Specializations"}),e.jsx("input",{type:"text",id:"specializations",name:"specializations",value:x.specializations,onChange:v,className:C,placeholder:"e.g., Crowd Control, Access Control, Emergency Response (comma-separated)"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Separate multiple specializations with commas"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"equipment_included",className:"block text-sm font-medium text-slate-700",children:"Equipment Included"}),e.jsx("input",{type:"text",id:"equipment_included",name:"equipment_included",value:x.equipment_included,onChange:v,className:C,placeholder:"e.g., Radio Communication, First Aid Kit, Flashlight (comma-separated)"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Separate multiple equipment items with commas"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Upload the logo of the company"}),e.jsx(re,{images:p,onImagesChange:_,maxImages:5,disabled:l})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"is_active",name:"is_active",checked:x.is_active,onChange:v,className:"h-4 w-4 text-[var(--primary-color)] bg-white border-slate-300 rounded focus:ring-[var(--primary-color)] focus:ring-2"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-slate-700",children:"Service is currently available for booking"})]}),e.jsxs("div",{className:"mt-4 p-4 bg-yellow-900/20 border border-yellow-500/30 rounded-lg",children:[e.jsx("h3",{className:"text-yellow-400 font-bold mb-2",children:"🔧 Debug Tools"}),e.jsx("button",{type:"button",onClick:ne,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors",children:"Check Storage Buckets"})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(ve,{type:"submit",disabled:l,className:"flex-1",children:l?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-slate-200 border-t-transparent rounded-full animate-spin"}),"Adding Service..."]}):"Add Service"}),e.jsx("button",{type:"button",onClick:()=>t("/dashboard/services"),className:"flex-1 bg-slate-100 text-slate-800 py-3 px-6 rounded-lg font-bold hover:bg-slate-200 transition-all duration-300",children:"Cancel"})]})]})})]})},Ee=()=>{const{user:t,hostProfile:h,refreshProfile:r}=V(),[l,u]=i.useState({}),[o,b]=i.useState(!1),[x,g]=i.useState(""),[p,_]=i.useState(""),[d,I]=i.useState({current:"",next:"",confirm:""}),[O,U]=i.useState([]),[P,S]=i.useState([]);i.useEffect(()=>{h&&u({...h})},[h]),i.useEffect(()=>{(async()=>{if(t!=null&&t.id)try{const{data:v}=await q.getHostServices(t.id);if(v&&v.length>0){S(v);const m=v[0];m.images&&m.images.length>0&&U(m.images)}}catch(v){console.error("Error fetching services for logo:",v)}})()},[t==null?void 0:t.id]);const C=i.useMemo(()=>new Set(Object.keys(l||{})),[l]),j=(a,v)=>{u(m=>({...m,[a]:v}))},f=async()=>{if(t){b(!0),g(""),_("");try{const a=["full_name","company_name","phone","address","company_description","bio"],v={};if(a.forEach(m=>{C.has(m)&&l[m]!==void 0&&(v[m]=l[m])}),Object.keys(v).length===0)g("Nothing to update");else{const{error:m}=await q.updateHostProfile(t.id,v);if(m)throw m;try{await r()}catch{}g("Saved successfully")}}catch(a){_(a.message||"Failed to save changes")}finally{b(!1),setTimeout(()=>{g(""),_("")},3e3)}}},s=async()=>{if(_(""),g(""),!d.next||d.next.length<6){_("Password must be at least 6 characters");return}if(d.next!==d.confirm){_("Passwords do not match");return}try{if(!(t!=null&&t.email))throw new Error("Missing user email");const{error:a}=await B.auth.signInWithPassword({email:t.email,password:d.current||""});if(a)throw new Error("Current password is incorrect");const{error:v}=await B.auth.updateUser({password:d.next});if(v)throw v;g("Password updated"),I({current:"",next:"",confirm:""})}catch(a){_(a.message||"Failed to update password")}finally{setTimeout(()=>{g(""),_("")},3e3)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#f8fbff] via-white to-[#fdfdff] text-slate-900 px-4 py-8 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-semibold text-slate-900 tracking-tight mb-3",children:"Account Settings"}),e.jsx("p",{className:"text-sm sm:text-base text-slate-500",children:"Manage your company profile and security preferences in one place."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"rounded-2xl p-6 border border-slate-200 bg-white shadow-[0_12px_40px_rgba(15,23,42,0.08)]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-emerald-600 text-lg",children:"business"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Company Profile"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Update your company information"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-3",children:"Company Logo"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-slate-50 border border-slate-200 flex items-center justify-center overflow-hidden group hover:border-emerald-400 transition-all duration-200",children:O.length>0?e.jsx("img",{src:O[0],alt:"Company Logo",className:"w-full h-full object-cover rounded-xl"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-xl group-hover:text-emerald-600 transition-colors",children:"business"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:O.length>0?"Logo from your service images. Upload a new logo to update it.":"No company logo found. Add a service with images to set your company logo."}),e.jsx(re,{images:O,onImagesChange:U,maxImages:1,disabled:o})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[C.has("company_name")&&e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"business"})}),e.jsx("input",{type:"text",value:l.company_name||"",onChange:a=>j("company_name",a.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"Company Name"})]}),C.has("full_name")&&e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"person"})}),e.jsx("input",{type:"text",value:l.full_name||"",onChange:a=>j("full_name",a.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"Contact Name"})]}),C.has("phone")&&e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"phone"})}),e.jsx("input",{type:"tel",value:l.phone||"",onChange:a=>j("phone",a.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"Phone Number"})]}),C.has("address")&&e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"location_on"})}),e.jsx("input",{type:"text",value:l.address||"",onChange:a=>j("address",a.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"Address"})]}),(C.has("company_description")||C.has("bio"))&&e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-4 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"description"})}),e.jsx("textarea",{rows:4,value:C.has("company_description")?l.company_description||"":l.bio||"",onChange:a=>C.has("company_description")?j("company_description",a.target.value):j("bio",a.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 resize-none text-sm",placeholder:"Company Description"})]})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-2xl p-6 border border-slate-200 bg-white shadow-[0_12px_40px_rgba(15,23,42,0.08)]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-emerald-600 text-lg",children:"lock"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Security Settings"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Manage your account security"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"lock"})}),e.jsx("input",{type:"password",value:d.current,onChange:a=>I(v=>({...v,current:a.target.value})),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"Current Password"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"lock_reset"})}),e.jsx("input",{type:"password",value:d.next,onChange:a=>I(v=>({...v,next:a.target.value})),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"New Password"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 z-10",children:e.jsx("span",{className:"material-symbols-outlined text-slate-400 text-lg",children:"verified_user"})}),e.jsx("input",{type:"password",value:d.confirm,onChange:a=>I(v=>({...v,confirm:a.target.value})),className:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 placeholder-slate-400 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-200 transition-all duration-200 text-sm",placeholder:"Confirm New Password"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:s,className:"px-4 py-2 rounded-lg border border-emerald-500/30 bg-emerald-50 text-emerald-700 text-sm font-medium hover:bg-emerald-100 transition-all duration-200",children:"Update Password"})})]})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 min-h-[32px]",children:[x&&e.jsxs("div",{className:"flex items-center gap-2 text-emerald-700 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"check_circle"}),e.jsx("span",{className:"font-medium",children:x})]}),p&&e.jsxs("div",{className:"flex items-center gap-2 text-rose-600 text-sm",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"error"}),e.jsx("span",{className:"font-medium",children:p})]})]}),e.jsx(E.button,{onClick:f,disabled:o,className:"inline-flex items-center justify-center px-6 py-3 rounded-xl bg-emerald-500 text-white text-sm font-semibold shadow-[0_12px_30px_rgba(16,185,129,0.4)] hover:bg-emerald-600 hover:shadow-[0_16px_40px_rgba(16,185,129,0.45)] transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed",whileHover:{scale:1.05},whileTap:{scale:.95},children:o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}),"Saving…"]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"save"}),"Save Changes"]})})]})]})})};function Ae(){const{user:t,hostProfile:h}=V(),r=ee();i.useState(!1);const[l,u]=i.useState(!1),[o,b]=i.useState(!1),[x,g]=i.useState(null),[p,_]=i.useState({company_registration:null,pan_card:null,gst_registration:null,trade_license:null,office_address_proof:null}),[d,I]=i.useState({}),[O,U]=i.useState(null),[P,S]=i.useState(null),[C,j]=i.useState(!1);i.useEffect(()=>{t&&h&&f()},[t,h]);const f=async()=>{try{const{data:y,error:L}=await B.from("host_kyc").select("*").eq("provider_id",t.id).order("submitted_at",{ascending:!1});if(L){console.error("Error fetching KYC status:",L);return}if(y&&y.length>0){g(y[0]);const z={};y.forEach(w=>{z[w.document_type]={id:w.id,status:w.status,url:w.document_url,submitted_at:w.submitted_at}}),I(z)}}catch(y){console.error("Error fetching KYC status:",y)}},s=async(y,L)=>{if(y){u(!0);try{const{data:{user:z},error:w}=await B.auth.getUser();if(w||!z)throw new Error("User not authenticated");console.log("Uploading for user:",z.id);const{data:F,error:M}=await B.storage.listBuckets();M?console.error("Error listing buckets:",M):console.log("Available buckets:",F.map(T=>T.id));const H=y.name.split(".").pop(),n=`${t.id}/${L}_${Date.now()}.${H}`;console.log("Uploading file:",n,"to bucket: host-kyc-documents");const{data:$,error:G}=await B.storage.from("host-kyc-documents").upload(n,y,{upsert:!0});if(G)throw console.error("Upload error details:",G),G;const{error:A}=await B.from("host_kyc").insert([{provider_id:t.id,document_type:L,document_url:$.path,status:"pending"}]);if(A)throw A;_(T=>({...T,[L]:y})),I(T=>({...T,[L]:{id:Date.now(),status:"pending",url:$.path,submitted_at:new Date().toISOString()}})),S("Document uploaded successfully!"),setTimeout(()=>S(null),3e3),await f()}catch(z){console.error("Error uploading document:",z),alert("Error uploading document. Please try again.")}finally{u(!1)}}},a=()=>["company_registration","pan_card"],v=()=>a().every(L=>d[L]),m=y=>{const L=d[y];if(!L)return{status:"not_uploaded",text:"Not uploaded"};const z={pending:{status:"pending",text:"Pending Review",color:"text-yellow-400"},approved:{status:"approved",text:"Approved",color:"text-green-400"},rejected:{status:"rejected",text:"Rejected",color:"text-red-400"}};return z[L.status]||z.pending},N=async()=>{if(!v()){U("Please upload all required documents before submitting.");return}b(!0),U(null),j(!1);try{const y=Object.entries(d).filter(([L,z])=>z.status==="pending").map(([L,z])=>L);if(y.length>0){const{error:L}=await B.from("host_kyc").update({status:"submitted",submitted_at:new Date().toISOString()}).in("document_type",y).eq("provider_id",t.id);if(L)throw L}S("KYC documents submitted successfully! Our admin team will review them within 1-3 business days. You will be notified once the verification is complete."),setTimeout(()=>{S(null),r("/dashboard")},5e3)}catch(y){console.error("Error submitting KYC:",y),U("Failed to submit documents. Please try again.")}finally{b(!1)}},k=()=>{j(!0)},c=()=>{j(!1)},R=y=>{const L={pending:{color:"bg-yellow-500/10 border-yellow-500/20 text-yellow-400",text:"Pending Review"},approved:{color:"bg-green-500/10 border-green-500/20 text-green-400",text:"Approved"},rejected:{color:"bg-red-500/10 border-red-500/20 text-red-400",text:"Rejected"}},z=L[y]||L.pending;return e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${z.color}`,children:z.text})};return!t||!h?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#f8fbff] via-white to-[#fdfdff] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-emerald-500/20 border-t-emerald-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Loading..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#f8fbff] via-white to-[#fdfdff] text-slate-900",children:[e.jsx("div",{className:"border-b border-slate-200 bg-white/80 backdrop-blur-xl",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-emerald-500/10 border border-emerald-500/30 flex items-center justify-center",children:e.jsx("span",{className:"material-symbols-outlined text-emerald-600 text-xl",children:"verified_user"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-semibold text-slate-900",children:"KYC Verification"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Upload and submit your company documents for verification."})]})]}),e.jsxs("button",{onClick:()=>r("/dashboard"),className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 hover:border-slate-300 transition-colors",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"arrow_back"}),e.jsx("span",{children:"Back to Dashboard"})]})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[x&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"rounded-2xl border border-slate-200 bg-white shadow-[0_12px_40px_rgba(15,23,42,0.08)] p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Current KYC Status"}),R(x.status)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Document Type:"}),e.jsx("span",{className:"text-slate-900 ml-2 capitalize",children:x.document_type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Submitted:"}),e.jsx("span",{className:"text-slate-900 ml-2",children:new Date(x.submitted_at).toLocaleDateString()})]}),x.reviewed_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-500",children:"Reviewed:"}),e.jsx("span",{className:"text-slate-900 ml-2",children:new Date(x.reviewed_at).toLocaleDateString()})]}),x.rejection_reason&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("span",{className:"text-slate-500",children:"Rejection Reason:"}),e.jsx("span",{className:"text-rose-600 ml-2",children:x.rejection_reason})]})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"rounded-2xl border border-slate-200 bg-white shadow-[0_12px_40px_rgba(15,23,42,0.08)] p-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-slate-900 mb-3",children:"Upload Documents"}),e.jsx("p",{className:"text-sm text-slate-500 mb-8",children:"Please upload the required documents for KYC verification. Our admin team will manually review and update your status."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-800",children:["Company Registration Certificate (Required)",e.jsx("span",{className:"text-rose-500 ml-1",children:"*"})]}),d.company_registration&&e.jsx("span",{className:`text-xs font-medium ${m("company_registration").color}`,children:m("company_registration").text})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Upload ROC / MSME / GST Registration certificate proving the legal existence of your company."}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:y=>s(y.target.files[0],"company_registration"),disabled:l,className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-500 file:text-white hover:file:bg-emerald-600 disabled:opacity-60"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-800",children:["PAN Card of the Company (Required)",e.jsx("span",{className:"text-rose-500 ml-1",children:"*"})]}),d.pan_card&&e.jsx("span",{className:`text-xs font-medium ${m("pan_card").color}`,children:m("pan_card").text})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Upload your company's PAN card for tax identification and compliance."}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:y=>s(y.target.files[0],"pan_card"),disabled:l,className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-500 file:text-white hover:file:bg-emerald-600 disabled:opacity-60"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-800",children:"GST Registration (If Applicable)"}),d.gst_registration&&e.jsx("span",{className:`text-xs font-medium ${m("gst_registration").color}`,children:m("gst_registration").text})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Upload GST registration certificate to verify legal tax compliance for operations."}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:y=>s(y.target.files[0],"gst_registration"),disabled:l,className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-500 file:text-white hover:file:bg-emerald-600 disabled:opacity-60"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-800",children:["Trade License / Security Agency License (Required)",e.jsx("span",{className:"text-rose-500 ml-1",children:"*"})]}),d.trade_license&&e.jsx("span",{className:`text-xs font-medium ${m("trade_license").color}`,children:m("trade_license").text})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Upload your trade license or security agency license (mandatory for running a security agency in most states)."}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:y=>s(y.target.files[0],"trade_license"),disabled:l,className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-500 file:text-white hover:file:bg-emerald-600 disabled:opacity-60"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-800",children:["Proof of Office Address (Required)",e.jsx("span",{className:"text-rose-500 ml-1",children:"*"})]}),d.office_address_proof&&e.jsx("span",{className:`text-xs font-medium ${m("office_address_proof").color}`,children:m("office_address_proof").text})]}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Upload utility bill, rent agreement, or lease document proving your office address."}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:y=>s(y.target.files[0],"office_address_proof"),disabled:l,className:"w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg text-slate-900 text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-emerald-500 file:text-white hover:file:bg-emerald-600 disabled:opacity-60"})]})]}),l&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-6 p-4 rounded-xl border border-emerald-100 bg-emerald-50/70",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-emerald-300/60 border-t-emerald-500 rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-emerald-700 font-medium",children:"Uploading document..."})]})}),P&&e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 rounded-xl border border-emerald-100 bg-emerald-50/70",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"material-symbols-outlined text-emerald-600 text-xl",children:"check_circle"}),e.jsx("span",{className:"text-sm text-emerald-700 font-medium",children:P})]})}),O&&e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-6 p-4 rounded-xl border border-rose-100 bg-rose-50/70",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"material-symbols-outlined text-rose-600 text-xl",children:"error"}),e.jsx("span",{className:"text-sm text-rose-700 font-medium",children:O})]})}),e.jsxs("div",{className:"mt-8 p-6 rounded-xl border border-slate-200 bg-slate-50/60",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800 mb-4",children:"Document Progress"}),e.jsx("div",{className:"space-y-3",children:a().map(y=>{const z=!!d[y],w=m(y);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-800 capitalize",children:y.replace("_"," ")}),e.jsxs("div",{className:"flex items-center space-x-2",children:[z?e.jsx("span",{className:`text-xs font-medium ${w.color}`,children:w.text}):e.jsx("span",{className:"text-xs text-slate-400",children:"Not uploaded"}),e.jsx("span",{className:`w-3 h-3 rounded-full ${z?"bg-emerald-500":"bg-slate-300"}`})]})]},y)})})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-8",children:[e.jsx("button",{onClick:v()?k:void 0,disabled:!v()||o,className:"w-full bg-emerald-500 text-white font-semibold py-4 px-6 rounded-xl hover:bg-emerald-600 transform hover:scale-[1.01] transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none shadow-[0_12px_30px_rgba(16,185,129,0.35)]",children:o?e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Submitting KYC Documents..."})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("span",{className:"material-symbols-outlined",children:"verified_user"}),e.jsx("span",{children:"Submit for Admin Verification"})]})}),e.jsx("p",{className:"text-center text-slate-500 text-xs mt-3",children:v()?"All required documents uploaded. Click to submit for manual admin verification.":"Upload Company Registration Certificate and PAN Card to enable submission."})]}),e.jsx("div",{className:"mt-8 p-6 rounded-xl border border-sky-100 bg-sky-50/80",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("span",{className:"material-symbols-outlined text-sky-600 text-xl",children:"info"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-sky-900 mb-2",children:"Important Information"}),e.jsxs("ul",{className:"text-xs text-slate-600 space-y-1",children:[e.jsx("li",{children:"• Documents should be clear and readable."}),e.jsx("li",{children:"• Accepted formats: JPG, PNG, PDF."}),e.jsx("li",{children:"• Maximum file size: 10MB per document."}),e.jsx("li",{children:"• Manual verification by admin team takes 1-3 business days."}),e.jsx("li",{children:"• You'll receive email notification once verification is complete."}),e.jsx("li",{children:"• Check your dashboard for real-time status updates."})]})]})]})})]})]}),e.jsx(se,{children:C&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:c,children:e.jsx(E.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"bg-white border border-slate-200 rounded-2xl p-8 max-w-md w-full mx-4 shadow-[0_18px_55px_rgba(15,23,42,0.18)]",onClick:y=>y.stopPropagation(),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-50 border border-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"material-symbols-outlined text-amber-500 text-2xl",children:"warning"})}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Confirm Submission"}),e.jsx("p",{className:"text-sm text-slate-600 mb-8",children:"Are you sure you want to submit these documents for admin review? Our team will manually verify your documents and notify you of the result."}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:c,className:"flex-1 px-6 py-3 bg-slate-50 border border-slate-200 text-slate-700 rounded-lg hover:bg-slate-100 transition-all duration-200",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:o,className:"flex-1 px-6 py-3 bg-emerald-500 text-white font-semibold rounded-lg hover:bg-emerald-600 transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed",children:o?"Submitting...":"Yes, Submit"})]})]})})})})]})}const le=({isOpen:t,onClose:h,title:r,children:l,widthClass:u="max-w-2xl",theme:o="dark"})=>{const b=o==="dark",x=b?`w-full ${u} rounded-2xl shadow-2xl border border-white/10 overflow-hidden bg-gradient-to-br from-[#1a1a1a]/90 to-[#0f0f0f]/90 backdrop-blur-xl`:`w-full ${u} bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden`,g=b?"px-6 py-4 border-b border-white/10 bg-white/5 flex items-center justify-between":"px-6 py-4 border-b border-gray-100 bg-gray-50 flex items-center justify-between",p=b?"text-lg font-semibold text-white":"text-lg font-semibold text-gray-800",_=b?"p-2 rounded-lg hover:bg-white/10":"p-2 rounded-lg hover:bg-gray-100",d=b?"material-symbols-outlined text-white/80":"material-symbols-outlined text-gray-600",I=b?"p-6 text-white":"p-6 bg-white";return e.jsx(se,{children:t&&e.jsxs(E.div,{className:"fixed inset-0 z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:h}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs(E.div,{className:x,initial:{y:20,opacity:0},animate:{y:0,opacity:1},exit:{y:20,opacity:0},transition:{type:"spring",stiffness:300,damping:24},children:[e.jsxs("div",{className:g,children:[e.jsx("h3",{className:p,children:r}),e.jsx("button",{onClick:h,className:_,children:e.jsx("span",{className:d,children:"close"})})]}),e.jsx("div",{className:I,children:l})]})})]})})},ie=["Guard","Bouncer","Bodyguard"],De=[{label:"Available",value:"Available"},{label:"Assigned",value:"Assigned"},{label:"Off-duty",value:"Off-duty"}],Pe=()=>{const{user:t}=V(),[h,r]=i.useState([]),[l,u]=i.useState({role:"",status:"",search:""}),[o,b]=i.useState(!1),[x,g]=i.useState(!1),[p,_]=i.useState({name:"",role:"Guard",phone:"",photo:"",status:!0}),[d,I]=i.useState([]),[O,U]=i.useState(0),[P,S]=i.useState(!1),[C,j]=i.useState(!1),[f,s]=i.useState("");i.useEffect(()=>{(async()=>{if(t!=null&&t.id)try{j(!0),s("");const{data:R,error:y}=await B.from("employees").select("id, name, role, phone, status, photo_url, experience_years, location").eq("host_id",t.id).order("created_at",{ascending:!1});if(y)throw y;const L=(R||[]).map(z=>({id:z.id,name:z.name,role:z.role,phone:z.phone,status:z.status,photo:z.photo_url||"",experience:z.experience_years||0,location:z.location||"",assignedTo:"—"}));r(L)}catch(R){s(R.message||"Failed to load employees")}finally{j(!1)}})()},[t==null?void 0:t.id]);const a=i.useMemo(()=>h.filter(c=>{const R=!l.role||c.role===l.role,y=!l.status||c.status===l.status,L=l.search.trim()===""||(c.name||"").toLowerCase().includes(l.search.toLowerCase());return R&&y&&L}),[h,l]),v=async()=>{if(t!=null&&t.id)try{j(!0);const c={host_id:t.id,name:p.name,role:p.role,phone:p.phone,status:p.status?"Available":"Off-duty",photo_url:p.photo||null,experience_years:null,location:null},{data:R,error:y}=await B.from("employees").insert(c).select("id, name, role, phone, status, photo_url, experience_years, location").single();if(y)throw y;const L={id:R.id,name:R.name,role:R.role,phone:R.phone,status:R.status,photo:R.photo_url||"",experience:R.experience_years||0,location:R.location||"",assignedTo:"—"};r(z=>[L,...z]),b(!1)}catch(c){alert(c.message||"Failed to add employee")}finally{j(!1)}},m=async c=>{try{j(!0);const{error:R}=await B.from("employees").delete().eq("id",c).eq("host_id",t.id);if(R)throw R;r(y=>y.filter(L=>L.id!==c))}catch(R){alert(R.message||"Failed to delete")}finally{j(!1)}},N=async c=>{if(!c)return;if((c.name.split(".").pop()||"").toLowerCase()!=="csv"){alert("Please upload a CSV file for now. Excel support can be added next.");return}const y=await c.text(),z=(n=>{const $=[];let G="",A=[],T=!1;for(let K=0;K<n.length;K++){const D=n[K];D==='"'?T&&n[K+1]==='"'?(G+='"',K++):T=!T:D===","&&!T?(A.push(G),G=""):(D===`
`||D==="\r")&&!T?((G!==""||A.length)&&(A.push(G),G=""),A.length&&($.push(A),A=[]),D==="\r"&&n[K+1]===`
`&&K++):G+=D}return(G!==""||A.length)&&(A.push(G),$.push(A)),$})(y);if(!z.length){alert("CSV is empty");return}const w=z[0].map(n=>(n||"").trim().toLowerCase()),F=n=>w.indexOf(n),M={name:F("name"),role:F("role"),phone:F("phone"),status:F("status"),photo:F("photo url")!==-1?F("photo url"):F("photo"),experience:F("experience"),location:F("location")};if(M.name===-1||M.role===-1||M.phone===-1){alert("CSV must include at least: Name, Role, Phone columns");return}const H=z.slice(1).filter(n=>n&&n.length).map(n=>({name:(n[M.name]||"").trim(),role:(n[M.role]||"").trim(),phone:(n[M.phone]||"").trim(),status:(n[M.status]||"available").trim().toLowerCase()||"available",photo:M.photo!==-1?(n[M.photo]||"").trim():"",experience:M.experience!==-1?Number((n[M.experience]||"0").trim()):0,location:M.location!==-1?(n[M.location]||"").trim():""})).filter(n=>n.name&&n.role&&n.phone);if(!H.length){alert("No valid rows found in CSV (need Name, Role, Phone)");return}I(H)},k=async()=>{if(t!=null&&t.id)try{j(!0);const c=A=>(A||"").replace(/[^0-9]/g,""),R=A=>{const T=c(A.phone);return T?`p:${T}`:`n:${(A.name||"").trim().toLowerCase()}|${(A.role||"").trim().toLowerCase()}`},y=new Set(h.map(A=>{const T=c(A.phone);return T?`p:${T}`:`n:${(A.name||"").trim().toLowerCase()}|${(A.role||"").trim().toLowerCase()}`})),L=new Set,w=d.filter(A=>{const T=R(A);return!T||y.has(T)||L.has(T)?!1:(L.add(T),!0)}).map(A=>({host_id:t.id,name:A.name,role:A.role,phone:A.phone,status:"Available",photo_url:A.photo||null,experience_years:Number(A.experience||0),location:A.location||null}));if(w.length===0){alert("No new employees to import (duplicates skipped)."),I([]),g(!1);return}if(P){const{error:A}=await B.from("employees").delete().eq("host_id",t.id);if(A)throw A}r([]);const{data:F,error:M}=await B.from("employees").insert(w).select("id, name, role, phone, status, photo_url, experience_years, location");if(M)throw M;const{data:H,error:n}=await B.from("employees").select("id, name, role, phone, status, photo_url, experience_years, location").eq("host_id",t.id).order("created_at",{ascending:!1});if(n)throw n;const $=(H||[]).map(A=>({id:A.id,name:A.name,role:A.role,phone:A.phone,status:A.status,photo:A.photo_url||"",experience:A.experience_years||0,location:A.location||"",assignedTo:"—"}));r($),I([]),g(!1);const G=d.length-w.length;alert(`Imported ${w.length} employee(s).${G>0?` Skipped ${G} duplicate(s).`:""}${P?" (Replaced previous dataset).":""}`)}catch(c){alert(c.message||"Failed to import")}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30 text-slate-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-slate-900 via-slate-800 to-[var(--primary-color)] bg-clip-text text-transparent mb-3",children:"My Employees"}),e.jsx("p",{className:"text-slate-600 text-base md:text-lg",children:"Manage staff, import from CSV/Excel, and assign quickly"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>{I([]),U(c=>c+1),g(!0)},className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 hover:shadow-lg transition-all font-semibold",children:[e.jsx("span",{className:"material-symbols-outlined",children:"upload"}),"Upload CSV / Excel"]}),e.jsxs("button",{onClick:()=>b(!0),className:"inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-gradient-to-r from-[var(--primary-color)] to-emerald-500 text-white shadow-lg hover:shadow-xl transition-all font-semibold",children:[e.jsx("span",{className:"material-symbols-outlined",children:"add"}),"Add Employee"]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-lg border border-slate-200/60 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",children:"search"}),e.jsx("input",{className:"w-full pl-12 pr-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-slate-50/50 text-slate-900 placeholder-slate-400",placeholder:"Search by name...",value:l.search,onChange:c=>u({...l,search:c.target.value})})]}),e.jsxs("select",{className:"px-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-white font-medium text-slate-700",value:l.role,onChange:c=>u({...l,role:c.target.value}),children:[e.jsx("option",{value:"",children:"All Roles"}),ie.map(c=>e.jsx("option",{value:c,children:c},c))]}),e.jsxs("select",{className:"px-4 py-3 rounded-xl border border-slate-200 focus:border-[var(--primary-color)] focus:ring-2 focus:ring-[var(--primary-color)]/20 outline-none transition-all bg-white font-medium text-slate-700",value:l.status,onChange:c=>u({...l,status:c.target.value}),children:[e.jsx("option",{value:"",children:"All Status"}),De.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]})]})})]}),e.jsx("div",{className:"rounded-2xl border border-slate-200 overflow-hidden bg-white shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gradient-to-r from-slate-50 to-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Photo"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Name"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Role"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Status"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Assigned To"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Actions"})]})}),e.jsxs("tbody",{children:[C&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-[var(--primary-color)] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Loading employees…"})]})}),!C&&a.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-6 py-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"👥"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"No employees found"}),e.jsx("p",{className:"text-slate-500",children:"Add your first employee to get started"})]})}),a.map(c=>e.jsxs(E.tr,{initial:{opacity:0},animate:{opacity:1},className:"border-t border-slate-100 hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-[var(--primary-color)] to-emerald-500 overflow-hidden flex items-center justify-center shadow-lg",children:c.photo?e.jsx("img",{src:c.photo,alt:c.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-white text-xl",children:"person"})})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"font-bold text-slate-900",children:c.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1.5 bg-slate-100 text-slate-700 rounded-full text-xs font-semibold",children:c.role})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1.5 rounded-full text-xs font-bold border ${c.status==="Available"?"bg-emerald-50 text-emerald-700 border-emerald-200":c.status==="Assigned"?"bg-rose-50 text-rose-700 border-rose-200":"bg-slate-50 text-slate-500 border-slate-200"}`,children:c.status==="Available"?"🟢 Available":c.status==="Assigned"?"🔴 Assigned":"⚫ Off-duty"})}),e.jsx("td",{className:"px-6 py-4 text-slate-700 font-medium",children:c.assignedTo||e.jsx("span",{className:"text-slate-400",children:"—"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 rounded-xl hover:bg-blue-50 transition-colors",title:"Edit",children:e.jsx("span",{className:"material-symbols-outlined text-blue-600 text-lg",children:"edit"})}),e.jsx("button",{onClick:()=>m(c.id),className:"p-2 rounded-xl hover:bg-rose-50 transition-colors",title:"Delete",children:e.jsx("span",{className:"material-symbols-outlined text-rose-500 text-lg",children:"delete"})})]})})]},c.id))]})]})})}),e.jsx(le,{isOpen:o,onClose:()=>b(!1),title:"Add Employee",theme:"dark",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Name"}),e.jsx("input",{className:"w-full px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white focus:ring-2 focus:ring-[#00AFFF]/20",value:p.name,onChange:c=>_({...p,name:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Role"}),e.jsx("select",{className:"w-full px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white focus:ring-2 focus:ring-[#00AFFF]/20",value:p.role,onChange:c=>_({...p,role:c.target.value}),children:ie.map(c=>e.jsx("option",{value:c,children:c},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Phone"}),e.jsx("input",{className:"w-full px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white focus:ring-2 focus:ring-[#00AFFF]/20",value:p.phone,onChange:c=>_({...p,phone:c.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Photo URL"}),e.jsx("input",{className:"w-full px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white focus:ring-2 focus:ring-[#00AFFF]/20",value:p.photo,onChange:c=>_({...p,photo:c.target.value})})]})]}),e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:p.status,onChange:c=>_({...p,status:c.target.checked}),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Set as Available"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10",children:"Cancel"}),e.jsx("button",{onClick:v,className:"px-4 py-2 rounded-xl bg-[#00AFFF] text-black shadow hover:shadow-md",children:"Add Employee"})]})]})}),e.jsx(le,{isOpen:x,onClose:()=>g(!1),title:"Upload CSV / Excel",theme:"dark",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-white/20 rounded-2xl p-8 text-center bg-white/5",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-3xl text-white",children:"upload"}),e.jsx("p",{className:"text-white/80",children:"Drop your CSV/Excel here or browse"}),e.jsx("input",{type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",onChange:c=>{var y;const R=(y=c.target.files)==null?void 0:y[0];R&&(I([]),N(R))},className:"mt-2"},O),e.jsx("button",{className:"text-[#00AFFF] underline text-sm mt-2",children:"Download Sample CSV"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:c=>S(c.target.checked)}),e.jsx("span",{className:"text-sm text-white/80",children:"Replace all existing employees with this CSV"})]}),d.length>0&&e.jsxs("span",{className:"text-sm text-white/60",children:["Rows parsed: ",d.length]})]}),d.length>0&&e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-white",children:["Preview (first ",Math.min(5,d.length)," rows)"]}),e.jsxs("span",{className:"text-sm text-white/70",children:["Valid: ",d.length]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-white/5 text-white/70",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Name"}),e.jsx("th",{className:"px-4 py-2",children:"Role"}),e.jsx("th",{className:"px-4 py-2",children:"Phone"}),e.jsx("th",{className:"px-4 py-2",children:"Status"}),e.jsx("th",{className:"px-4 py-2",children:"Photo URL"}),e.jsx("th",{className:"px-4 py-2",children:"Experience"}),e.jsx("th",{className:"px-4 py-2",children:"Location"})]})}),e.jsx("tbody",{children:d.slice(0,5).map((c,R)=>e.jsxs("tr",{className:"border-t border-white/10",children:[e.jsx("td",{className:"px-4 py-2",children:c.name}),e.jsx("td",{className:"px-4 py-2",children:c.role}),e.jsx("td",{className:"px-4 py-2",children:c.phone}),e.jsx("td",{className:"px-4 py-2",children:c.status}),e.jsx("td",{className:"px-4 py-2 truncate max-w-[200px]",children:c.photo||"—"}),e.jsxs("td",{className:"px-4 py-2",children:[c.experience," yrs"]}),e.jsx("td",{className:"px-4 py-2",children:c.location})]},R))})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{I([]),U(c=>c+1),g(!1)},className:"px-4 py-2 rounded-xl border border白/10 bg-white/5 hover:bg-white/10",children:"Cancel"}),e.jsx("button",{disabled:d.length===0,onClick:k,className:"px-4 py-2 rounded-xl bg-[#16a34a] text-white shadow disabled:opacity-50",children:"Import Employees"})]})]})})]})})};function Me({bookingId:t,startTime:h,durationHours:r,onComplete:l}){const[u,o]=i.useState(0),[b,x]=i.useState(!1);if(i.useEffect(()=>{if(!h||b)return;const I=setInterval(()=>{const O=new Date,U=new Date(h),P=(O-U)/1e3;o(P)},1e3);return()=>clearInterval(I)},[h,b]),i.useEffect(()=>{if(!h||!r||b)return;const I=r*3600;u>=I&&(x(!0),(async()=>{try{await q.completeService(t),l&&l()}catch(U){console.error("Failed to complete service:",U)}})())},[u,r,t,h,b,l]),!h||b)return e.jsx("div",{className:"text-lg font-semibold text-gray-400",children:b?"✅ Service Completed":"⏳ Not Started"});const g=Math.max(r*3600-u,0),p=Math.floor(g/3600),_=Math.floor(g%3600/60),d=Math.floor(g%60);return e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:["⏱️ ",p,"h ",_,"m ",d,"s remaining"]})}const Be=()=>{const{user:t}=V(),[h,r]=i.useState([]),[l,u]=i.useState(!1),[o,b]=i.useState(""),[x,g]=i.useState([]),[p,_]=i.useState(null),[d,I]=i.useState({}),[O,U]=i.useState({});i.useEffect(()=>{const s=async()=>{if(t!=null&&t.id)try{u(!0),b("");const{data:v,error:m}=await B.from("employees").select("id, name, role, phone, photo_url, experience_years, location").eq("host_id",t.id).eq("status","Available").order("created_at",{ascending:!1});if(m)throw m;const N=(v||[]).map(k=>({id:k.id,name:k.name,role:k.role,phone:k.phone,photo:k.photo_url||"",experience:k.experience_years||0,location:k.location||""}));r(N)}catch(v){b(v.message||"Failed to load employees")}finally{u(!1)}},a=async()=>{if(t!=null&&t.id)try{const{data:v,error:m}=await B.from("bookings").select("id, user_id, service_type, date, location, status, start_time, end_time, service_status, assigned_employee_id, duration_hours").eq("provider_id",t.id).in("status",["pending","assigned","in_progress"]).order("created_at",{ascending:!1});if(m)throw m;const N=(v||[]).map(k=>({id:k.id,userId:k.user_id,serviceType:k.service_type,date:k.date,location:k.location,status:k.status,startTime:k.start_time||null,endTime:k.end_time||null,serviceStatus:k.service_status||null,assignedEmployeeId:k.assigned_employee_id||null,durationHours:k.duration_hours||0}));g(N)}catch{}};s(),a()},[t==null?void 0:t.id]),i.useEffect(()=>{if(!(t!=null&&t.id))return;const s=B.channel(`assignments_bookings_${t.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"bookings",filter:`provider_id=eq.${t.id}`},async()=>{try{const{data:a}=await B.from("bookings").select("id, user_id, service_type, date, location, status, start_time, end_time, service_status").eq("provider_id",t.id).eq("status","pending").order("created_at",{ascending:!1}),v=(a||[]).map(m=>({id:m.id,userId:m.user_id,serviceType:m.service_type,date:m.date,location:m.location,status:m.status,startTime:m.start_time||null,endTime:m.end_time||null,serviceStatus:m.service_status||null}));g(v)}catch{}}).subscribe();return()=>{try{B.removeChannel(s)}catch{}}},[t==null?void 0:t.id]);const P=async()=>{if(t!=null&&t.id)try{const[s,a]=await Promise.all([B.from("employees").select("id, name, role, phone, photo_url, experience_years, location, status").eq("host_id",t.id).eq("status","available").order("created_at",{ascending:!1}),B.from("bookings").select("id, user_id, service_type, date, location, status").eq("provider_id",t.id).in("status",["pending","confirmed"]).order("created_at",{ascending:!1})]);if(!s.error){const v=(s.data||[]).map(m=>({id:m.id,name:m.name,role:m.role,phone:m.phone,photo:m.photo_url||"",experience:m.experience_years||0,location:m.location||""}));r(v)}if(!a.error){const v=(a.data||[]).map(m=>({id:m.id,userId:m.user_id,serviceType:m.service_type,date:m.date,location:m.location,status:m.status}));g(v)}}catch{}},S=async(s,a)=>{if(!(!s||!a))try{const{error:v}=await B.from("bookings").update({assigned_employee_id:s,service_status:"assigned",status:"assigned",updated_at:new Date().toISOString()}).eq("id",a);if(v)throw v;const{error:m}=await B.from("employees").update({status:"Assigned"}).eq("id",s);if(m)throw m;const{error:N}=await B.from("guard_assignments").insert({guard_id:s,booking_id:a,status:"active"});if(N)throw N;const{data:k}=await B.from("bookings").select("id, user_id").eq("id",a).single(),{data:c}=await B.from("employees").select("name, role, phone").eq("id",s).single();k!=null&&k.user_id&&c&&await B.from("notifications").insert({user_id:k.user_id,type:"booking_update",title:"Employee Assigned",message:`Employee ${c.name} has been assigned to your booking.`}),await P(),_(null)}catch(v){alert(v.message||"Assignment failed")}},C=async s=>{var m;const a=(d[s]||"").trim();if(!a||a.length!==6){alert("Enter the 6-digit OTP");return}const v=await q.startServiceWithOtp(s,a);if(v.ok){alert("✅ OTP Verified. Service Started!"),I(N=>({...N,[s]:""}));try{const{data:N}=await B.from("bookings").select("id, user_id, service_type, date, location, status, start_time, end_time, service_status, assigned_employee_id, duration_hours").eq("provider_id",t.id).in("status",["pending","assigned","in_progress"]).order("created_at",{ascending:!1}),k=(N||[]).map(c=>({id:c.id,userId:c.user_id,serviceType:c.service_type,date:c.date,location:c.location,status:c.status,startTime:c.start_time||null,endTime:c.end_time||null,serviceStatus:c.service_status||null,assignedEmployeeId:c.assigned_employee_id||null,durationHours:c.duration_hours||0}));g(k)}catch{}}else alert(((m=v==null?void 0:v.error)==null?void 0:m.message)||"❌ Incorrect OTP. Please try again.")},j=async s=>{try{const{otp:a,error:v}=await q.generateBookingOtp(s);if(v)throw v;U(m=>({...m,[s]:a})),alert(`OTP Generated: ${a}`)}catch(a){alert("Failed to generate OTP: "+a.message)}},f=async s=>{try{const{data:a}=await B.from("bookings").select("id, user_id, service_type, date, location, status, start_time, end_time, service_status, assigned_employee_id, duration_hours").eq("provider_id",t.id).in("status",["pending","assigned","in_progress","completed"]).order("created_at",{ascending:!1}),v=(a||[]).map(m=>({id:m.id,userId:m.user_id,serviceType:m.service_type,date:m.date,location:m.location,status:m.status,startTime:m.start_time||null,endTime:m.end_time||null,serviceStatus:m.service_status||null,assignedEmployeeId:m.assigned_employee_id||null,durationHours:m.duration_hours||0}));g(v)}catch{}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-[#f8fbff] via-white to-[#fdfdff] text-slate-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6 md:p-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-semibold text-slate-900 mb-6",children:"Assignment Board"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 shadow-[0_10px_40px_rgba(15,23,42,0.08)] p-4 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-slate-900",children:"Available Employees"}),e.jsxs("div",{className:"min-h-[400px] rounded-xl border border-dashed border-slate-200 p-3",children:[l&&e.jsx("div",{className:"text-slate-500 p-4",children:"Loading…"}),!l&&o&&e.jsx("div",{className:"text-rose-600 p-4",children:o}),!l&&!o&&h.length===0&&e.jsx("div",{className:"text-slate-500 p-4",children:"No available employees"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.map(s=>e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-2xl ${p?"ring-1 ring-sky-200":""}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white overflow-hidden flex items-center justify-center",children:s.photo?e.jsx("img",{src:s.photo,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-slate-400",children:"person"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-slate-900 font-medium",children:s.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.role," • ",s.experience," yrs",s.location?` • ${s.location}`:""]})]}),e.jsx("button",{onClick:()=>{if(!p){alert('Select a booking first: click "Assign Employee" on a booking card.');return}S(s.id,p)},className:"px-3 py-1 rounded-xl bg-slate-900 text-white text-sm font-semibold",children:"Assign"})]},s.id))})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 shadow-[0_10px_40px_rgba(15,23,42,0.08)] p-4 bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3 text-slate-900",children:"Active Bookings"}),e.jsxs("div",{className:"min-h-[400px] rounded-xl border border-dashed border-slate-200 p-3",children:[x.length===0&&e.jsx("div",{className:"text-slate-500 p-4",children:"No active bookings"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:x.map(s=>e.jsxs("div",{className:`p-3 bg-slate-50 border border-slate-200 rounded-2xl ${p===s.id?"ring-2 ring-sky-200":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-slate-900 font-semibold",children:["Booking #",String(s.id).slice(0,8)]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="pending"?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700"}`,children:s.status})]}),e.jsxs("div",{className:"mt-2 text-sm text-slate-600",children:[e.jsxs("div",{children:["Service: ",e.jsx("span",{className:"font-medium capitalize text-slate-900",children:s.serviceType})]}),s.date&&e.jsxs("div",{children:["Date: ",new Date(s.date).toLocaleDateString()]}),e.jsxs("div",{children:["Location: ",s.location]}),s.startTime&&e.jsxs("div",{children:["Started: ",new Date(s.startTime).toLocaleString()]}),s.endTime&&e.jsxs("div",{children:["Ended: ",new Date(s.endTime).toLocaleString()]}),s.assignedEmployeeId&&e.jsx("div",{className:"text-emerald-600 font-medium",children:"✓ Employee Assigned"})]}),s.serviceStatus==="in_progress"&&s.startTime&&e.jsx("div",{className:"mt-3 p-3 bg-emerald-50 border border-emerald-100 rounded-lg",children:e.jsx(Me,{bookingId:s.id,startTime:s.startTime,durationHours:s.durationHours,onComplete:()=>f(s.id)})}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[p===s.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"Now select an employee to assign"}),e.jsx("button",{onClick:()=>_(null),className:"px-3 py-1 rounded-xl border border-slate-200 text-slate-600 text-sm",children:"Cancel"})]}):s.status==="pending"?e.jsx("button",{onClick:()=>_(s.id),className:"px-3 py-1 rounded-xl bg-slate-900 text-white text-sm font-semibold",children:"Assign Employee"}):s.status==="assigned"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(s.id),className:"px-3 py-1 rounded-xl bg-amber-500 text-white text-sm font-semibold",children:"Generate OTP"}),O[s.id]&&e.jsxs("span",{className:"text-emerald-600 text-sm font-medium",children:["OTP: ",O[s.id]]})]}):null,e.jsx("button",{className:"px-3 py-1 rounded-xl border border-slate-200 text-slate-600 text-sm",children:"Details"})]}),s.status==="assigned"&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("input",{className:"px-3 py-2 rounded-lg border border-slate-200 bg-white text-slate-800 w-32",placeholder:"Enter OTP",value:d[s.id]||"",onChange:a=>I(v=>({...v,[s.id]:a.target.value.replace(/\D/g,"").slice(0,6)}))}),e.jsx("button",{onClick:()=>C(s.id),className:"px-3 py-1 rounded-xl bg-emerald-500 text-white text-sm font-semibold",children:"Start Service"})]})]},s.id))})]})]})]})]})})},$e=()=>{const{user:t}=V(),[h,r]=i.useState(!1),[l,u]=i.useState(""),[o,b]=i.useState(0),[x,g]=i.useState({}),[p,_]=i.useState({}),[d,I]=i.useState([]);i.useEffect(()=>{(async()=>{if(t!=null&&t.id)try{r(!0),u("");const{data:S,error:C}=await B.from("employees").select("id, role, location").eq("host_id",t.id).eq("status","Assigned");if(C)throw C;b((S==null?void 0:S.length)||0);const j={},f={};(S||[]).forEach(a=>{j[a.role]=(j[a.role]||0)+1,a.location&&(f[a.location]=(f[a.location]||0)+1)}),g(j),_(f);const{data:s}=await B.from("guard_assignments").select("guard_id, booking_id, assigned_at, status").order("assigned_at",{ascending:!1}).limit(10);if(s&&s.length){const a=Array.from(new Set(s.map(y=>y.guard_id).filter(Boolean))),v=Array.from(new Set(s.map(y=>y.booking_id).filter(Boolean))),[{data:m},{data:N}]=await Promise.all([B.from("employees").select("id, name, role, phone").in("id",a).eq("host_id",t.id),B.from("bookings").select("id, user_id, service_type, date, location").in("id",v).eq("provider_id",t.id)]),k=Object.fromEntries((m||[]).map(y=>[y.id,y])),c=Object.fromEntries((N||[]).map(y=>[y.id,y])),R=s.map(y=>({assignedAt:y.assigned_at,employee:k[y.guard_id]||null,booking:c[y.booking_id]||null,status:y.status}));I(R)}else I([])}catch(S){u(S.message||"Failed to load analytics")}finally{r(!1)}})()},[t==null?void 0:t.id]);const O=i.useMemo(()=>Object.entries(x),[x]),U=i.useMemo(()=>Object.entries(p),[p]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-blue-50/30 text-slate-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6 md:p-8 lg:p-10",children:[e.jsxs("div",{className:"mb-10",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-slate-900 via-slate-800 to-[var(--primary-color)] bg-clip-text text-transparent mb-3",children:"Analytics"}),e.jsx("p",{className:"text-slate-600 text-base md:text-lg",children:"Insights into your employee assignments and performance"})]}),l&&e.jsx("div",{className:"mb-6 p-4 rounded-2xl border border-rose-200 bg-rose-50 text-rose-700 shadow-lg",children:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-6 mb-10",children:[e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-slate-50 border border-slate-200/80 shadow-lg hover:shadow-2xl hover:shadow-blue-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"group"})})}),e.jsx("p",{className:"text-slate-500 text-xs font-semibold uppercase tracking-wider mb-2",children:"Assigned Employees"}),e.jsx("p",{className:"text-4xl font-extrabold text-slate-900",children:o})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-emerald-50/50 border border-emerald-200/80 shadow-lg hover:shadow-2xl hover:shadow-emerald-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-emerald-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-4 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"badge"})})}),e.jsx("p",{className:"text-emerald-600 text-xs font-semibold uppercase tracking-wider mb-2",children:"By Role"}),O.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:"No data"}):e.jsx("div",{className:"space-y-2",children:O.map(([P,S])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-700 font-medium",children:P}),e.jsx("span",{className:"font-bold text-slate-900 text-lg",children:S})]},P))})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"group relative overflow-hidden rounded-2xl p-6 bg-gradient-to-br from-white to-sky-50/50 border border-sky-200/80 shadow-lg hover:shadow-2xl hover:shadow-sky-200/30 transition-all duration-300 hover:-translate-y-2",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-sky-100/50 to-transparent rounded-full blur-2xl"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"p-4 bg-gradient-to-br from-sky-500 to-sky-600 rounded-2xl shadow-lg group-hover:scale-110 transition-transform duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-3xl",children:"location_on"})})}),e.jsx("p",{className:"text-sky-600 text-xs font-semibold uppercase tracking-wider mb-2",children:"By Location"}),U.length===0?e.jsx("p",{className:"text-slate-400 text-sm",children:"No data"}):e.jsx("div",{className:"space-y-2",children:U.map(([P,S])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-700 font-medium truncate",children:P}),e.jsx("span",{className:"font-bold text-slate-900 text-lg",children:S})]},P))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 shadow-lg p-6 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"pie_chart"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Role Distribution"})]}),e.jsx("div",{className:"h-64 rounded-xl bg-slate-50 border border-slate-200 flex items-center justify-center text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl mb-2 block",children:"pie_chart"}),e.jsx("p",{children:"Chart visualization coming soon"})]})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 shadow-lg p-6 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"bar_chart"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Employee Count by Location"})]}),e.jsx("div",{className:"h-64 rounded-xl bg-slate-50 border border-slate-200 flex items-center justify-center text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl mb-2 block",children:"bar_chart"}),e.jsx("p",{children:"Chart visualization coming soon"})]})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 shadow-lg p-6 lg:col-span-2 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-sky-500 to-sky-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"show_chart"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Assignment Activity (7 days)"})]}),e.jsx("div",{className:"h-64 rounded-xl bg-slate-50 border border-slate-200 flex items-center justify-center text-slate-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl mb-2 block",children:"show_chart"}),e.jsx("p",{children:"Chart visualization coming soon"})]})})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 shadow-lg p-6 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl shadow-lg",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg",children:"history"})}),e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Recent Assignments"})]}),h?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-[var(--primary-color)] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"Loading assignments…"})]}):d.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-5xl mb-3",children:"📊"}),e.jsx("p",{className:"text-slate-500",children:"No recent assignments"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gradient-to-r from-slate-50 to-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Assigned At"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Employee"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Role"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Booking"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-slate-700",children:"Location"})]})}),e.jsx("tbody",{children:d.map((P,S)=>{var C,j,f;return e.jsxs(E.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:S*.05},className:"border-t border-slate-100 hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 text-slate-700 font-medium",children:P.assignedAt?new Date(P.assignedAt).toLocaleString():"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-900 font-semibold",children:((C=P.employee)==null?void 0:C.name)||"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-xs font-semibold",children:((j=P.employee)==null?void 0:j.role)||"—"})}),e.jsx("td",{className:"px-6 py-4 text-slate-700 font-medium",children:P.booking?`#${String(P.booking.id).slice(0,8)} (${P.booking.service_type||P.booking.serviceType||""})`:"—"}),e.jsx("td",{className:"px-6 py-4 text-slate-700",children:((f=P.booking)==null?void 0:f.location)||"—"})]},S)})})]})})]})]})})},Le=({isOpen:t,onClose:h,booking:r})=>{const{user:l}=V(),[u,o]=i.useState({role:"",location:"",search:""}),[b,x]=i.useState({}),[g,p]=i.useState([]),[_,d]=i.useState(!1);i.useEffect(()=>{(async()=>{if(!(!t||!(l!=null&&l.id)))try{d(!0);const{data:C,error:j}=await B.from("employees").select("id, name, role, status, photo_url, experience_years, location").eq("host_id",l.id).order("created_at",{ascending:!1});if(j)throw j;const f=(C||[]).map(s=>({id:s.id,name:s.name,role:s.role,status:s.status,photo:s.photo_url||"",exp:s.experience_years||0,location:s.location||""}));p(f)}catch{}finally{d(!1)}})()},[t,l==null?void 0:l.id]);const I=i.useMemo(()=>g.filter(S=>{const C=!u.role||S.role===u.role,j=!u.location||(S.location||"").toLowerCase().includes(u.location.toLowerCase()),f=!u.search||S.name.toLowerCase().includes(u.search.toLowerCase());return C&&j&&f}),[g,u]),O=S=>x(C=>({...C,[S]:!C[S]})),U=()=>{const C=I.filter(j=>j.status==="Available").slice(0,2).map(j=>j.name).join(", ");alert(`Auto assigned: ${C}`),h()},P=()=>{const S=Object.entries(b).filter(([,C])=>C).map(([C])=>C);alert(`Assigned ${S.length} guard(s) to Booking #${(r==null?void 0:r.id)||"—"}`),h()};return e.jsx(le,{isOpen:t,onClose:h,title:"New Booking Received!",theme:"dark",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-white/80",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"Booking ID:"})," ",(r==null?void 0:r.id)||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"User:"})," ",(r==null?void 0:r.user)||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"Service:"})," ",(r==null?void 0:r.service_type)||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"Date:"})," ",(r==null?void 0:r.date)||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"Location:"})," ",(r==null?void 0:r.location)||"—"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-white/50",children:"search"}),e.jsx("input",{value:u.search,onChange:S=>o({...u,search:S.target.value}),placeholder:"Search guard",className:"w-full pl-10 pr-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white placeholder-white/50 focus:ring-2 focus:ring-[#00AFFF]/20"})]}),e.jsxs("select",{value:u.role,onChange:S=>o({...u,role:S.target.value}),className:"px-3 py-2 rounded-xl bg-white/5 border border-white/10 text-white focus:ring-2 focus:ring-[#00AFFF]/20",children:[e.jsx("option",{value:"",children:"All Roles"}),e.jsx("option",{children:"Guard"}),e.jsx("option",{children:"Bouncer"}),e.jsx("option",{children:"Bodyguard"})]}),e.jsx("input",{value:u.location,onChange:S=>o({...u,location:S.target.value}),placeholder:"Filter by location",className:"px-3 py-2 rounded-xl bg白/5 border border-white/10 text-white placeholder-white/50 focus:ring-2 focus:ring-[#00AFFF]/20"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-72 overflow-auto pr-1",children:[_&&e.jsx("div",{className:"col-span-2 text-white/70",children:"Loading…"}),!_&&I.map(S=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-white/5 border border-white/10 rounded-2xl hover:bg-white/10 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!b[S.id],onChange:()=>O(S.id)}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex items-center justify-center overflow-hidden",children:S.photo?e.jsx("img",{src:S.photo,alt:S.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"material-symbols-outlined text-white/60",children:"person"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-white",children:S.name}),e.jsxs("div",{className:"text-xs text-white/70",children:[S.role," • ",S.exp," yrs • ",S.location]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${S.status==="Available"?"bg-emerald-500/20 text-emerald-300":"bg-white/10 text-white/70"}`,children:S.status})]},S.id))]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:U,className:"px-4 py-2 rounded-xl bg-[#00AFFF] text-black shadow hover:shadow-md",children:"Auto Assign Best Match"}),e.jsx("button",{onClick:P,className:"px-4 py-2 rounded-xl bg-[#16a34a] text-white shadow hover:shadow-md",children:"Assign Selected Guards"}),e.jsx("button",{onClick:h,className:"px-4 py-2 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10",children:"Cancel"})]})]})})},ze=()=>{const[t,h]=i.useState(!1),[r,l]=i.useState(null),u=[{id:123,user:"Rahul Sharma",service_type:"Guard",date:"2025-10-08",location:"Indore",status:"pending"},{id:124,user:"Anita Patel",service_type:"Bouncer",date:"2025-10-10",location:"Bhopal",status:"confirmed"}];i.useState({});const[o,b]=i.useState(""),x=async g=>{var _;if(!o||o.length!==6){alert("Enter the 6-digit OTP");return}const p=await q.startServiceWithOtp(g,o);p.ok?(alert("✅ OTP Verified. Service Started!"),b("")):alert(((_=p==null?void 0:p.error)==null?void 0:_.message)||"❌ Incorrect OTP. Please try again.")};return e.jsxs("div",{className:"min-h-screen bg-[#f8fafc] text-gray-800",children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-6 md:p-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-semibold text-[#1e3a8a] mb-6",children:"Booking Management"}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"text-gray-600",children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"User Name"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Service"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Date"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Location"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:u.map(g=>e.jsxs("tr",{className:"border-t border-gray-100",children:[e.jsx("td",{className:"px-4 py-3",children:g.user}),e.jsx("td",{className:"px-4 py-3",children:g.service_type}),e.jsx("td",{className:"px-4 py-3",children:g.date}),e.jsx("td",{className:"px-4 py-3",children:g.location}),e.jsx("td",{className:"px-4 py-3 capitalize",children:g.status}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs("button",{onClick:()=>{l(g),h(!0)},className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-[#1e3a8a] text-white shadow hover:shadow-md",children:[e.jsx("span",{className:"material-symbols-outlined",children:"group_add"}),"Assign Employee"]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{className:"px-3 py-2 border rounded-lg w-32",placeholder:"Enter OTP",value:o,onChange:p=>b(p.target.value.replace(/\D/g,"").slice(0,6))}),e.jsxs("button",{onClick:()=>x(g.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-green-600 text-white shadow hover:shadow-md",children:[e.jsx("span",{className:"material-symbols-outlined",children:"play_arrow"}),"Start Service"]})]})]})]},g.id))})]})})})]}),e.jsx(Le,{isOpen:t,onClose:()=>h(!1),booking:r})]})},Ue=()=>{const t=ce(),h=ee(),{user:r,hostProfile:l,signOut:u}=V(),[o,b]=i.useState(!1),[x,g]=i.useState(!0),p=[{path:"/dashboard",label:"Dashboard",icon:"dashboard",color:"from-blue-500 to-cyan-500"},{path:"/dashboard/bookings",label:"Bookings",icon:"event",color:"from-teal-500 to-cyan-600"},{path:"/dashboard/services",label:"My Services",icon:"security",color:"from-green-500 to-emerald-500"},{path:"/dashboard/employees",label:"My Employees",icon:"group",color:"from-indigo-500 to-blue-600"},{path:"/dashboard/assignments",label:"Assignments",icon:"assignment_turned_in",color:"from-sky-500 to-cyan-600"},{path:"/dashboard/analytics",label:"Analytics",icon:"analytics",color:"from-purple-500 to-pink-500"},{path:"/dashboard/add-service",label:"Add Service",icon:"add",color:"from-purple-500 to-pink-500"},{path:"/dashboard/kyc",label:"KYC Verification",icon:"verified_user",color:"from-yellow-500 to-orange-500"},{path:"/dashboard/account",label:"Account",icon:"person",color:"from-orange-500 to-red-500"}];i.useEffect(()=>{const d=setTimeout(()=>{g(!1)},1e3);return()=>clearTimeout(d)},[]),i.useEffect(()=>{const d=I=>{(I.ctrlKey||I.metaKey)&&I.key==="b"&&(I.preventDefault(),b(!o))};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[o]),i.useEffect(()=>{const d=()=>{window.innerWidth<768&&b(!0)};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const _=async()=>{(await u()).success&&h("/")};return x?e.jsx("div",{className:"bg-gradient-to-b from-[#f8fbff] via-white to-[#fdfdff] text-slate-900 min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"w-16 h-16 mx-auto mb-4 relative",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-[var(--primary-color)] border-t-transparent animate-spin"}),e.jsx("div",{className:"absolute inset-2 rounded-full border-2 border-slate-200 border-t-transparent animate-spin",style:{animationDirection:"reverse",animationDuration:"0.8s"}})]}),e.jsx("h2",{className:"text-xl font-bold text-slate-700 animate-pulse",children:"Loading dashboard…"})]})}):e.jsxs("div",{className:"bg-gradient-to-b from-[#f8fbff] via-white to-[#fdfdff] text-slate-900 min-h-screen flex animate-fade-in-up",children:[e.jsxs("div",{className:`${o?"w-16":"w-72"} bg-white border-r border-slate-200 ${o?"p-3":"p-6"} flex flex-col transition-all duration-300 ease-in-out relative overflow-hidden backdrop-blur-xl shadow-[0_10px_40px_rgba(15,23,42,0.06)]`,children:[e.jsxs("div",{className:"absolute inset-0 opacity-60 pointer-events-none",children:[e.jsx("div",{className:`absolute ${o?"top-6 left-3":"top-8 left-8"} w-40 h-40 bg-gradient-to-br from-emerald-200 to-emerald-400 rounded-full blur-3xl`}),e.jsx("div",{className:`absolute ${o?"bottom-12 right-3":"bottom-16 right-8"} w-32 h-32 bg-sky-200 rounded-full blur-2xl`,style:{animationDelay:"2s"}})]}),o&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-0.5 bg-gradient-to-b from-emerald-400 via-green-500 to-emerald-400 opacity-60"}),e.jsxs("div",{className:`flex items-center ${o?"justify-center":"gap-3"} mb-8 relative z-10`,children:[e.jsxs("div",{className:"relative",children:[e.jsx(xe,{showText:!o,text:"Defendo",className:`${o?"justify-center":"items-center gap-2"}`,imgClassName:`${o?"h-9 w-9":"h-10 w-auto"} drop-shadow-lg`,textClassName:"text-xl font-bold text-slate-900"}),e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 rounded-full animate-pulse shadow-lg shadow-emerald-400/50"})]}),!o&&e.jsx("p",{className:"text-xs text-slate-500 font-medium",children:"Security Platform"})]}),e.jsx("button",{onClick:()=>b(!o),className:"absolute top-1/2 -translate-y-1/2 -right-3 w-8 h-8 flex items-center justify-center rounded-full bg-white shadow-lg border border-slate-200 hover:border-emerald-300 hover:shadow-emerald-200/60 transition-all duration-200 z-20 group backdrop-blur-sm",title:o?"Expand sidebar":"Collapse sidebar",children:e.jsx("span",{className:"material-symbols-outlined text-emerald-400 text-sm group-hover:scale-110 transition-transform",children:o?"chevron_right":"chevron_left"})}),e.jsx("div",{className:"mb-6 relative z-10",children:e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(ae,{to:"/dashboard/add-service",className:`group flex items-center ${o?"justify-center px-3 py-3":"gap-3 px-4 py-3"} rounded-xl transition-all duration-300 relative overflow-hidden bg-[var(--primary-color)]/10 border border-[var(--primary-color)]/40 hover:border-[var(--primary-color)]/60 hover:shadow-lg hover:shadow-[var(--primary-color)]/25`,title:o?"Add Service":"",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-[var(--primary-color)] to-emerald-500 shadow-lg group-hover:shadow-emerald-300/40 transition-all duration-300",children:e.jsx("span",{className:"material-symbols-outlined text-white text-lg font-bold",children:"add"})}),!o&&e.jsx("span",{className:"font-semibold text-slate-900 group-hover:text-slate-950 transition-colors",children:"Add Service"}),o&&e.jsxs("div",{className:"absolute left-full ml-3 top-1/2 transform -translate-y-1/2 bg-[#0a0a0a] text-white px-3 py-2 rounded-xl text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50 border border-emerald-500/20 shadow-xl",children:["Add Service",e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-[#0a0a0a] border-l border-t border-emerald-500/20 rotate-45"})]})]})})}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent mb-6"}),e.jsxs("nav",{className:`${o?"space-y-3":"space-y-2"} flex-1 relative z-10`,children:[p.map((d,I)=>e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:I*.06,type:"spring",stiffness:300,damping:24},whileHover:{scale:1.02},children:e.jsxs(ae,{to:d.path,className:`group flex items-center ${o?"justify-center px-3 py-3":"gap-3 px-4 py-3"} rounded-xl transition-all duration-300 ease-out relative ${t.pathname===d.path?"bg-slate-100 border border-[var(--primary-color)]/60 text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900 hover:bg-slate-100/70 hover:border hover:border-slate-200"}`,title:o?d.label:"",children:[t.pathname===d.path&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-[var(--primary-color)] rounded-r"}),e.jsx("div",{className:`p-2 rounded-lg transition-all duration-300 ${t.pathname===d.path?"bg-[var(--primary-color)]/10":"group-hover:bg-slate-100"}`,children:e.jsx("span",{className:`material-symbols-outlined ${o?"text-xl":"text-lg"} ${t.pathname===d.path?"text-[var(--primary-color)]":"text-slate-500 group-hover:text-slate-800"}`,children:d.icon})}),!o&&e.jsx("span",{className:"font-medium text-sm transition-all duration-300 whitespace-nowrap",children:d.label}),t.pathname===d.path&&!o&&e.jsx(E.div,{className:"ml-auto w-2 h-2 bg-[var(--primary-color)] rounded-full shadow-lg shadow-emerald-300/70",animate:{scale:[1,1.3,1]},transition:{repeat:1/0,duration:1.6,ease:"easeInOut"}}),o&&t.pathname===d.path&&e.jsx("div",{className:"absolute -right-1 top-1/2 transform -translate-y-1/2 w-1 h-6 bg-[var(--primary-color)] rounded-full shadow-lg shadow-emerald-300/70"}),o&&e.jsxs("div",{className:"absolute left-full ml-3 top-1/2 transform -translate-y-1/2 bg-white text-slate-900 px-3 py-2 rounded-xl text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50 border border-slate-200 shadow-xl",children:[d.label,e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-[#0a0a0a] border-l border-t border-emerald-500/20 rotate-45"})]})]})},d.path)),e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},whileHover:{scale:1.02},children:e.jsxs("button",{onClick:_,className:`w-full group flex items-center ${o?"justify-center px-3 py-3":"gap-3 px-4 py-3"} rounded-xl transition-all duration-300 ease-out relative text-slate-500 hover:text-red-600 hover:bg-red-50 hover:border hover:border-red-200`,title:o?"Logout":"",children:[e.jsx("div",{className:"p-2 rounded-lg transition-all duration-300 group-hover:bg-red-50",children:e.jsx("span",{className:`material-symbols-outlined ${o?"text-xl":"text-lg"} text-slate-500 group-hover:text-red-500`,children:"logout"})}),!o&&e.jsx("span",{className:"font-medium transition-all duration-300 whitespace-nowrap",children:"Logout"}),o&&e.jsxs("div",{className:"absolute left-full ml-3 top-1/2 transform -translate-y-1/2 bg-white text-slate-900 px-3 py-2 rounded-xl text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50 border border-red-200 shadow-xl",children:["Logout",e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-[#0a0a0a] border-l border-t border-red-500/20 rotate-45"})]})]})})]}),e.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent mb-6"}),e.jsx("div",{className:`mt-auto ${o?"pt-4":"pt-6"} relative z-10`,children:e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:`${o?"p-3":"p-4"} rounded-xl bg-white border border-slate-200 shadow-[0_10px_40px_rgba(15,23,42,0.08)] hover:shadow-[0_18px_60px_rgba(15,23,42,0.16)] transition-all duration-300 group cursor-pointer`,title:o?"KADFORCE SERVICES - Security Provider":"",children:e.jsxs("div",{className:`flex items-center ${o?"justify-center":"gap-3"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`${o?"w-10 h-10":"w-12 h-12"} rounded-full bg-gradient-to-br from-[var(--primary-color)] to-emerald-500 flex items-center justify-center text-white font-bold ${o?"text-sm":"text-base"} shadow-lg shadow-emerald-300/40`,children:"KS"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-emerald-400 rounded-full border-2 border-[#0a0a0a] animate-pulse shadow-lg shadow-emerald-400/50"})]}),!o&&e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-slate-900 font-semibold truncate group-hover:text-[var(--primary-color)] transition-colors",children:"KADFORCE SERVICES"}),e.jsx("p",{className:"text-slate-500 text-sm truncate font-medium",children:"Security Provider"})]}),o&&e.jsxs("div",{className:"absolute left-full ml-3 top-1/2 transform -translate-y-1/2 bg-[#0a0a0a] text-white px-3 py-2 rounded-xl text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50 border border-emerald-500/20 shadow-xl",children:[e.jsx("div",{className:"font-semibold",children:"KADFORCE SERVICES"}),e.jsx("div",{className:"text-xs text-white/60",children:"Security Provider"}),e.jsx("div",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-[#0a0a0a] border-l border-t border-emerald-500/20 rotate-45"})]})]})})})]}),e.jsx("div",{className:`flex-1 bg-gradient-to-br from-slate-50 via-white to-blue-50/30 animate-slide-in-right transition-all duration-300 ${o?"ml-0":""}`,children:e.jsx("div",{className:"max-w-7xl mx-auto p-6 md:p-8 lg:p-10",children:e.jsxs(me,{children:[e.jsx(Y,{index:!0,element:e.jsx(pe,{})}),e.jsx(Y,{path:"bookings",element:e.jsx(Ne,{})}),e.jsx(Y,{path:"services",element:e.jsx(be,{})}),e.jsx(Y,{path:"services/:id/edit",element:e.jsx(ye,{})}),e.jsx(Y,{path:"employees",element:e.jsx(Pe,{})}),e.jsx(Y,{path:"assignments",element:e.jsx(Be,{})}),e.jsx(Y,{path:"analytics",element:e.jsx($e,{})}),e.jsx(Y,{path:"booking-management",element:e.jsx(ze,{})}),e.jsx(Y,{path:"add-service",element:e.jsx(Ie,{})}),e.jsx(Y,{path:"kyc",element:e.jsx(Ae,{})}),e.jsx(Y,{path:"account",element:e.jsx(Ee,{})})]})})})]})};export{Ue as default};
